<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">	
    <title>Chat With Us</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">  
    <style>
        body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
   background-color: white;
    color: black;
    overflow: hidden;
     min-width: 1024px;
     overflow-x: hidden;
}
    #profile-settings-section {
      width: 95%;
      top: 10%;
      text-align: center;
      background-color: #365387;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .profile-settings-profile-icon {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid #3498db;
      margin-bottom: 10px;
    }

    .profile-settings-username {
      font-size: 35px;
      font-weight: bold;
      color: #ddd;
      margin-bottom: 10px;
    }

    .additional-settings-text {
      font-size: 20px;
      font-weight: 600;
      color: #aaa;
      text-align: left;
      margin-bottom: 30px;
    }
    
    #profile-settings-section div {
      background-color: #f0f0f0;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: left;
      color: #7f8c8d;
      font-size: 18px;
      text-align: left;
    }
    #profile-settings-section div h3 {
    	color: #827;
    }
    #profile-settings-section div p {
    	margin-top: 10px;
        color: #103;
    }
    .signUp-profile-upload-wrapper {
  width: 150px;
  height: 150px;
  border: 4px dashed #007bff;
  border-radius: 50%;
  margin: 20px auto;
  overflow: hidden;
  margin-top: -10%;
  cursor: pointer;
  position: relative;
  background-color: #f0f0f0;
  transition: 0.3s ease;
}

#signUp-profile-preview {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.loading-border::after {
  content: '';
  position: absolute;
  top: -5px;
  left: -5px;
  width: 210px;
  height: 210px;
  border: 5px solid transparent;
  border-top: 5px solid #4CAF50;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  z-index: 1;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

    .profileIconmodal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .profileIconmodal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .circle-frame {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto 15px;
      border: 3px solid #4CAF50;
    }

    .circle-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #saveProfileImage {
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
#network-popup {
  position: fixed;
  top: 50%; left: 40%;
  inset: 0;
  background: #fff;
  z-index: 9999;
  display: none;
  align-items: center;
  justify-content: center;
  pointer-events: all;
}

.popup-content {
  background: white;
  padding: 2rem 3rem;
  border-radius: 1rem;
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.15);
  text-align: center;
  max-width: 90%;
  width: 400px;
}

.popup-content h2 {
  margin-bottom: 1rem;
  color: #e53935;
}

.popup-content p {
  color: #333;
}

.login-history-modal {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    z-index: 9999;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease;
}

/* Modal Content */
.history-content {
    background-color: #fff;
    width: 80%;
    max-width: 600px;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    position: relative;
    transform: scale(0.9);
    transition: transform 0.3s ease, opacity 0.3s ease;
}

/* Open animation for the modal */
.login-history-modal.open {
    display: flex;
    opacity: 1;
    visibility: visible;
    transform: scale(1);
}

/* Close Button */
.history-close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 28px;
    color: #333;
    cursor: pointer;
}

/* Title */
.history-content h2 {
    font-size: 24px;
    color: #333;
    text-align: center;
    margin-bottom: 20px;
}

/* Login History List */
#login-history-list {
    list-style: none;
    padding: 0;
}

#login-history-list li {
    background-color: #f8f9fa;
    padding: 15px;
    margin: 10px 0;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    font-size: 16px;
    color: #555;
}

#login-history-list li:hover {
    background-color: #e9ecef;
}

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
#Edit-profile {
  max-width: 800px;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  margin: auto;
  position: relative;
  top: 50%;
  border-radius: 16px;
  backdrop-filter: blur(15px);
  box-shadow: 2px 8px 32px rgba(150, 670, 0, 0.9);
  overflow: hidden;
  animation: fadeInOut 2.5s ease-in-out;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: rgba(0,0,0,0.3);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.back-arrow, .save-btn {
  cursor: pointer;
  font-weight: bold;
  font-size: 18px;
  color: #86a8e7;
  transition: color 0.3s;
}

.back-arrow:hover, .save-btn:hover {
  color: #b0c4ff;
}

header h2 {
  font-size: 20px;
  text-align: center;
}

.tabs {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: transparent;
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  position: relative;
}

.tab {
  padding: 8px 16px;
  border-radius: 20px;
  background: #5865F2;
  color: #fff;
  font-weight: 600;
}

.profile-banner {
  display: flex;
  justify-content: center;
  margin-top: 40px;
}

.avatar-wrapper {
  position: relative;
  background: rgba(255, 255, 255, 0.1);
  padding: 10px;
  right: 0;
  border-radius: 50%;
  box-shadow: 0 0 15px rgba(255,255,255,0.1);
}

.avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #fff;
  transition: transform 0.3s;
}

.avatar:hover {
  transform: scale(1.05);
}

.edit-icon {
  position: absolute;
  bottom: 0;
  right: 0;
  background: #5865F2;
  color: white;
  border-radius: 50%;
  padding: 8px;
  font-size: 14px;
  box-shadow: 0 0 10px #5865F2;
  cursor: pointer;
}

.profile-content {
  padding: 20px;
}

.quote {
  text-align: center;
  font-style: italic;
  color: #ccc;
  margin-bottom: 10px;
}

.real-username {
  text-align: center;
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 4px;
}

.field {
  margin-bottom: 20px;
}

.field label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  color: #ddd;
}

.field input {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: none;
  background: rgba(255, 255, 255, 0.08);
  color: white;
  font-size: 15px;
  outline: none;
  transition: box-shadow 0.3s;
}

.field input:focus {
  box-shadow: 0 0 0 2px #5865F2;
}

/* Animation */
@keyframes fadeInOut {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Responsive */
@media (max-width: 500px) {
  .avatar {
    width: 90px;
    height: 90px;
  }

  header h2 {
    font-size: 18px;
  }

  .display-username {
    font-size: 20px;
  }
}

    #settingsGroupIcon {
  width: 80px; /* or whatever size you need */
  height: 80px;
  border-radius: 50%; /* if you want it circular */
  position: relative;
  z-index: 1;
  overflow: hidden;
}

/* Add shimmer overlay */
#settingsGroupIcon::after {
  content: '';
  position: absolute;
  top: -120%;
  left: -120%;
  width: 300%;
  height: 300%;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0) 45%,
    rgba(255, 255, 255, 0.5) 50%,
    rgba(255, 255, 255, 0) 55%
  );
  animation: shimmerDiagonal 4s infinite;
  pointer-events: none;
  z-index: 2;
}
.icon-wrapper {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  overflow: hidden;
  position: relative;
  display: inline-block;
}

.icon-wrapper::after {
  content: '';
  position: absolute;
  top: -120%;
  left: -120%;
  width: 300%;
  height: 300%;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0) 45%,
    rgba(255, 255, 255, 0.5) 50%,
    rgba(255, 255, 255, 0) 55%
  );
  animation: shimmerDiagonal 5s infinite;
  pointer-events: none;
  z-index: 2;
}

.invite-icon {
  font-size: 40px;
  color: #fff;
  padding: 18px;
  border-radius: 50%;
  background: linear-gradient(145deg, #44d684, #2d995f);
  box-shadow:
    6px 6px 15px rgba(0, 0, 0, 0.4),
    -6px -6px 15px rgba(255, 255, 255, 0.2),
    inset 1px 1px 4px rgba(255, 255, 255, 0.2),
    inset -1px -1px 4px rgba(0, 0, 0, 0.1);
  transition: transform 3s ease, box-shadow 3s ease;
  animation: pulseGlow 1s infinite ease-in-out, popIn 5s ease-out;
  position: relative;
  overflow: hidden;
}

.invite-icon::after {
  content: '';
  position: absolute;
  top: -120%;
  left: -120%;
  width: 300%;
  height: 300%;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0) 45%,
    rgba(255, 255, 255, 0.4) 50%,
    rgba(255, 255, 255, 0) 55%
  );
  animation: shimmerDiagonal 2s infinite;
  z-index: 1;
  pointer-events: none;
}

.invite-icon {
  z-index: 2;
}



  /* Glow on hover */
  .invite-icon:hover {
    transform: translateY(-6px) scale(1.05);
    box-shadow:
      0 0 15px #6ef09d,
      0 0 30px #3ce88c,
      6px 6px 20px rgba(0, 0, 0, 0.3),
      inset 1px 1px 4px rgba(255, 255, 255, 0.3);
  }

  /* Click bounce */
  .invite-icon:active {
    transform: scale(0.9);
    box-shadow: inset 2px 2px 6px rgba(0,0,0,0.3);
  }

  /* Shimmer line effect */
.invite-icon::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(135deg, rgba(255,255,255,0) 40%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 60%);
  transform: rotate(0deg);
  animation: shimmerDiagonal 2s infinite;
  pointer-events: none;
  z-index: 1;
  border-radius: 50%;
  mask-image: radial-gradient(circle, black 65%, transparent 70%);
}

/* Diagonal shimmer animation */
@keyframes shimmerDiagonal {
  0% {
    transform: translate(-100%, -100%) rotate(0deg);
  }
  100% {
    transform: translate(100%, 100%) rotate(0deg);
  }
}


  /* Entry animation */
  @keyframes popIn {
    0% { transform: scale(0.5) rotate(-10deg); opacity: 0; }
    100% { transform: scale(1) rotate(0); opacity: 1; }
  }

  /* Glow/pulse animation */
  @keyframes pulseGlow {
    0%, 100% {
      box-shadow:
        6px 6px 15px rgba(0, 0, 0, 0.4),
        -6px -6px 15px rgba(255, 255, 255, 0.2),
        0 0 10px #44d684;
    }
    50% {
      box-shadow:
        8px 8px 18px rgba(0, 0, 0, 0.5),
        -8px -8px 18px rgba(255, 255, 255, 0.3),
        0 0 20px #6ef09d;
    }
  }

  /* Shimmer line animation */
  @keyframes shimmer {
    0% { left: -45%; }
    100% { left: 90%; }
  }

    #group-settings {
      max-width: 950;
      min-height: 800px;
      background: #1e1e2f;
      margin: 0 auto;
      background: #1e1e2f
      background: #fff;
      border-radius: 1rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
      overflow: hidden;
    }
.group-footer {
  padding: 2rem;
  max-height: 750px; /* Adjust the height as needed */
  overflow-y: auto;  /* Enables vertical scrolling */
  scroll-behavior: smooth;  /* Smooth scroll effect */
  overscroll-behavior: contain;  /* Prevents over-scroll bounce on mobile */
  scrollbar-width: thin;  /* Firefox: thinner scrollbar */
  scrollbar-color: #bbb transparent;  /* Firefox: scrollbar colors */
}

    .group-header,
    .group-footer {
      padding: 2rem;
    }

    .group-header {
      border-bottom: 1px solid #e0e0e0;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-wrap: nowrap;
      gap: 1rem;
    }

    .group-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .group-info img {
      width: 80px;
      height: 80px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    animation: pulseGlow 3s infinite ease-in-out, popIn 2s ease-out;
      border-radius: 50%;
      border: 2px solid #ddd;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
.group-info img::after {
    content: '';
    position: absolute;
    top: 0;
    left: -75%;
    width: 50%;
    height: 100%;
    background: linear-gradient(120deg, rgba(255,255,255,0.1), rgba(255,255,255,0.3), rgba(255,255,255,0.1));
    transform: skewX(-25deg);
    animation: shimmer 3s infinite;
  }
    .group-details h2 {
      margin: 0;
      font-size: 1.5rem;
     color: #A7D8FF; 
     text-shadow: 4px 3px 4px rgba(23, 50, 90, 9);
    }

    .group-details p {
      margin: 0.25rem 0 0 0;
      font-size: 0.9rem;
      color: #aaa;
    }

    .button-group {
      display: flex;
      gap: 0.5rem;
    }

    .btn-invite {
      background-color: #3b82f6;
      color: white;
    }

    .btn-back {
      background-color: #10b981;
      color: white;
    }

    .btn-back:hover {
      background-color: #059669;
    }

    .group-meta {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #aaa;
    }

    .group-footer h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    .members-grid {
      display: flex;
  flex-direction: column;
  gap: 1.2rem;
    }

.group-footer::-webkit-scrollbar {
  width: 15px;
}

.group-footer::-webkit-scrollbar-thumb {
  background: linear-gradient(145deg, #d4d4d4, #a1a1a1);
  border-radius: 12px;
  border: 2px solid #f9fafb;
}

.group-footer::-webkit-scrollbar-track {
  background: #f0f0f0;
  border-radius: 12px;
}

.member-card {
  opacity: 0;
  transform: translateY(-450px);
  animation: fadeSlideUp 2.5s ease forwards;
  background-color: #f9fafb;
  border-radius: 1rem;
  padding: 1.8rem;
  width: 95%;
  max-width: 1000px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
}
@keyframes fadeSlideUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.member-info {
      display: flex;
  align-items: center;
  gap: 1rem;
}

.member-info img {
  border-radius: 50%;
  width: 50px;
  height: 50px;
  border: 2px solid black;
  object-fit: cover;
}

.member-card span {
  font-size: 1.5rem;
  color: #333;
  margin-left: 10px; /* Space from the image */
  margin-top: -40; /* Remove any unnecessary top margin */
}
#joinedUsersListDisplay {
    list-style: none;
    padding-left: 0;
    margin-top: 10px;
}

#joinedUsersListDisplay li {
    padding: 8px;
    background: #fff;
    border: 1px solid #ccc;
    margin-bottom: 5px;
    border-radius: 5px;
    font-size: 16px;
}

#blockedFriendsList {
  max-height: 300px;
  overflow-y: auto;
  padding-right: 8px; 
  scrollbar-width: thin;
  scrollbar-color: #ccc transparent;
}

/* Optional: Webkit scrollbar style */

    .drag-handle {
            width: 50px;
            height: 8px;
            background: #aaa;
            border-radius: 50px;
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            cursor: grab;
            opacity: 0.8;
        }


/* Button hover effect */

    
  .error-message {
    color: red;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    background: rgba(255, 0, 0, 0.1);
    border: 2px solid red;
    padding: 15px;
    border-radius: 10px;
    margin: 20px auto;
    width: 80%;
    margin-top: 25%;
    box-shadow: 0 0 10px red;
}
.chat-controls {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 100px;
    padding: 20px;
    background: rgba(0, 0, 0, 0.5);
    border-top-left-radius: 30px;
    border-top-right-radius: 30px;
    box-shadow: 0 -8px 20px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border-top: 2px solid rgba(255, 255, 255, 0.2);
    transform: translateY(-50%);
}

.chat-controls button {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(135deg, #6e45e2, #88d3ce);
    color: white;
    font-size: 50px;
    cursor: pointer;
    transition: 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}

.chat-controls button:hover {
    transform: scale(1.1);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}

.chat-controls button:nth-child(1) { background: linear-gradient(135deg, #ff7eb3, #ff758c); } /* Chat */
.chat-controls button:nth-child(2) { background: linear-gradient(135deg, #7F7FD5, #86A8E7); } /* Video */
.chat-controls button:nth-child(3) { background: linear-gradient(135deg, #ff9a9e, #fecfef); } /* Audio */

#blockedUsersList {
    max-height: 300px; /* Adjust height as needed */
    overflow-y: auto; /* Enables vertical scrolling */
    padding: 10px;
    border: 1px solid #ccc; /* Optional: adds a border */
}

.three-dots-button {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 5px;
    text-align: right;
}
.profile-card {
    width: 100%;
    height: 100%;
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease-in-out;
}
.cover {
    width: 100%;
    height: 150px;
    background: linear-gradient(135deg, #6a11cb, #2575fc);
    border-radius: 10px 10px 10px 10px;
    position: relative;
}

        .profile-info {
            position: relative;
            margin-top: -50px;
            text-align: left;
        }

        .friend-profile-icon {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid white;
        }

        .actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        .profile-details {
            margin: 10px 0 5px;
            font-size: 24px;
            text-align: left;
        }
        .username, .mutual-friend {
            color: gray;
            font-size: 14px;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .buttons button {
            border: none;
            background: #ddd;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        .member-since {
            margin-top: -15px;
            font-size: 28px;
            color: white;
            text-align: right;
        }

        .note-section {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            color: gray;
            width: 80%;
        }
        
            .profile-card {
                font-size: 16px;
                padding: 15px;
            }
.friend-about {
	width: 950px;
	min-height: 100px; /* allow the height to grow if text is longer */
	border: 4px solid #fff;
	white-space: normal; /* allow text to wrap */
	background: transparent;
	border-bottom-left-radius: 50px;
	border-top-right-radius: 50px;
	margin-left: 10px;
	padding: 10px; /* optional: adds breathing space inside the box */
}

.friends-info-dropdown {
    position: fixed;
    bottom: -100%;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    height: 55%;
    background: #18191c;
    color: #fff;
    border-radius: 20px 20px 0 0;
    box-shadow: 0px -5px 15px rgba(0, 0, 0, 0.3);
    text-align: center;
    padding: 20px;
    transition: bottom 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    font-size: 18px;
    font-weight: bold;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 50px;
    touch-action: none;
}

/* Profile container */
.friend-profile-container {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid #fff;
    margin-bottom: 10px;
}

/* Profile image */

/* Swipe-down handle */
.friends-info-dropdown::before {
    content: "";
    width: 50px;
    height: 5px;
    background: #aaa;
    border-radius: 5px;
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    cursor: pointer;
    opacity: 0.7;
}

/* Visible state */
.friends-info-dropdown.visible {
    bottom: 0;
    animation: bounce 1s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Improved Bounce effect */
@keyframes bounce {
    0% { bottom: -50%; }
    60% { bottom: 5%; }
    80% { bottom: -3%; }
    100% { bottom: 0; }
}


.group-texts {
    background: linear-gradient(45deg, rgb(255, 94, 98), rgb(255, 166, 0), rgb(0, 204, 255));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: bold;
    font-size: 18px;
}
img {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 50%;
    background: #fff;
}

        /* Dropdown Box */
        .details-box {
            display: none;
            position: absolute;
            top: 30px;
            right: 0;
            background: white;
            border-radius: 8px;
            padding: 10px;
            width: 150px;
            z-index: 1000;
        }

        .details-box button {
            display: block;
            width: 110%;
            background: yellow;
            border: none;
            padding: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 24px;
            color: black;
            box-shadow: none;
        }

/* Dropdown Box */
    .dropdown {
      position: fixed;
      bottom: -100%; /* Start hidden */
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      height: 35%;
      background: #aaa;
      border-radius: 20px 20px 0 0;
      box-shadow: 0px -5px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
      padding: 20px;
      transition: bottom 0.4s ease-in-out;
      z-index: 999;
    }

    .dropdown.active {
      bottom: 0;
    }

    .profile-header {
      background: #25531D;
      height: 120px;
      position: relative;
      border-top-right-radius: 20px;
      border-top-left-radius: 20px;
    }

    .profile-pic {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      position: absolute;
      left: 20px;
      bottom: -45px;
      border: 4px solid white;
    }

    .status-dot {
      width: 14px;
      height: 14px;
      background: #43b581;
      border: 3px solid white;
      border-radius: 50%;
      position: absolute;
      left: 100px;
      bottom: -25px;
    }

    .note-bubble {
      position: absolute;
      left: 150px;
      bottom: -15px;
      background: #fff;
      padding: 8px 12px;
      border-radius: 15px;
      font-size: 14px;
      color: #000;
      box-shadow: 0 1px 5px rgba(0,0,0,0.2);
      max-width: 160px;
      text-align: left;
      animation: containerGlow 4s forwards, containerGlowInfinite 4s infinite; /* Glow for 4s then infinite */
  animation-delay: 3s;
    }


    .profile-body {
      padding: 60px 20px 20px 20px;
      text-align: left;
    }

    .username {
      font-size: 22px;
      font-weight: bold;
      color: #333;
      margin-top: 10px;
    }

    .about {
      font-size: 16px;
      color: #555;
      margin-top: 5px;
    }

    .edit-btn {
      background: #5865F2;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px;
      width: 100px;
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 20px;
      cursor: pointer;
    }

    .info-box {
      margin-bottom: 15px;
    }

    .label {
      font-weight: 600;
      font-size: 24px;
      color: #555;
      background: #fafafa;
      border-radius: 15px;
      text-align: left;
      padding: 20px;
      width: 75%;
    }
    .edit-note-box {
      display: flex;
      flex-direction: column;
    }
    #note-text {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      resize: vertical;
      font-size: 14px;
      background-color: #f9f9f9;
    }
    #save-btn {
      margin-top: 10px;
      padding: 8px 12px;
      background-color: #4A90E2;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #save-btn:hover {
      background-color: #357ABD;
    }
        .dot-1, .dot-2, .dot-3 {
      border-radius: 50%;
      position: absolute;
    }

    .dot-1 {
      width: 15px;
      height: 15px;
      background: linear-gradient(90deg, #ff416c, #ccc);
      left: 95px;
      bottom: 45px;
      animation: dotGlow 4s infinite;
      animation-delay: 0s;
    }

    .dot-2 {
      width: 20px;
      height: 20px;
      background: linear-gradient(90deg, #ff416c, #ccc);
      left: 115px;
      bottom: 40px;
      animation: dotGlow 4s infinite;
      animation-delay: 1s;
    }

    .dot-3 {
      width: 25px;
      height: 25px;
      background: linear-gradient(-90deg, #aaa , #ff416c);
      left: 135px;
      bottom: 25px;
      animation: dotGlow 4s infinite;
      animation-delay: 2s;
    }

    @keyframes dotGlow {
      0%, 100% {
        box-shadow: 0 0 0 transparent;
      }
      10% {
        box-shadow: 0 0 8px 3px #ff416c;
      }
      20% {
        box-shadow: 0 0 0 transparent;
      }
    }

@keyframes containerGlow {
  0%, 90% {
    box-shadow: 0 0 0 transparent;
  }
  95%, 100% {
    box-shadow: 0 0 18px 5px rgba(255, 182, 193, 1); /* Glow for 4 seconds */
  }
}

@keyframes containerGlowInfinite {
  0%, 100% {
    box-shadow: 0 0 0 transparent;
  }
  10% {
    box-shadow: 5px 2px 18px 12px #ff416c;
  }
}
.group-item {
    width: 95%;
    padding: 15px;
    margin: 10px auto;
    background: linear-gradient(135deg, rgba(255,0,255,0.3), rgba(0,255,255,0.3));
    border-radius: 10px;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease-in-out;
}
#FetchFriends {
    overflow-y: auto;
    max-height: 300px;
    scroll-behavior: smooth;
    padding: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

/* Custom Scrollbar */
#FetchFriends::-webkit-scrollbar {
    width: 8px;
}

#FetchFriends::-webkit-scrollbar-thumb {
    background: #ffcc00;
    border-radius: 10px;
}

#FetchFriends::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
}


/* Three Dots Button */
.three-dots-container {
    position: absolute;
    top: 10px;
    right: 10px;
}

.group-sidebar-btn {
    border: none;
    background: none;
    box-shadow: none;
    color: #aaa;
    padding: 0;
    font-size: 30px;
    cursor: pointer;
}

/* Friends Invitation Button */
.options-dropdown button {
    background: #ccc;
    color: yellow;
    border: none;
    white-space: nowrap;  /* Prevents text from wrapping */
    text-align: center;   /* Ensures text is centered */
    padding: 10px 15px;   /* Adds enough space inside the button */
    width: auto;          /* Allows the button to adjust to text size */
    min-width: 150px;
    border-radius: 5px;
}

/* Hover Effect */
.options-dropdown button:hover {
    background: #0056b3;
}


#fetchFriends {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 60%;
    max-width: 600px;
    background: white;
    color: black;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: transform 0.3s ease-out, opacity 0.3s ease-out;
    z-index: 3000;
}

#fetchFriends.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
}

/* Background Overlay */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease-in-out;
    z-index: 2500;
}

.modal-overlay.active {
    opacity: 1;
    visibility: visible;
}

        /* Create Group Button (Center) */
#createGroupBtn {
    position: fixed;
    top: -10px; /* Align to the top */
    right: 0px; /* Place it beside the menu button */
    width: 65px;
    height: 65px;
    background: linear-gradient(135deg, #007BFF, #0056b3);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    z-index: 1000; /* Ensure it stays on top */
}

.SideBarBtns {
    width: 90%;
    height: 100px;
    padding: 12px;
    background: linear-gradient(45deg, #ff416c, #ff4b2b); /* Stylish gradient */
    color: white;
    text-align: center;
    font-size: 28px;
    border-radius: 10px;
    margin-left: 20px;
}

/* Hover Effect */

/*  General Section Styling */
#friendRequestsSection, #friendsListSection, #invitationSection{
    width: 100%;
    max-width: 800px;
    margin: 20px auto;
    padding: 20px;
    background: linear-gradient(135deg, #1e1e1e, #333);
    color: white;
    border-radius: 12px;
    box-shadow: 0px 10px 25px rgba(0, 0, 0, 0.3);
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
    opacity: 0;
    transform: scale(0.9);
    display: none;
}

#friendRequestsSection.active, #friendsListSection.active, #invitationSection{
    opacity: 1;
    transform: scale(1);
    display: block;
}

/*  Section Titles */
#friendRequestsSection h2, #friendsListSection h2, #invitationSection {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 15px;
    letter-spacing: 1px;
    color: #f7c45d;
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
}

/*  Request & Friends List Container */
#friendRequestsList, #friendsList, #inviteList {
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    box-shadow: inset 0px 0px 8px rgba(255, 255, 255, 0.1);
}

/*  Individual Friend Request & Friend Item */
.friend-request-item, .friend-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.1);
    margin-bottom: 10px;
    transition: transform 0.2s ease-in-out, background 0.3s ease-in-out;
}

.friend-request-item:hover, .friend-item:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 0.2);
}

/*  Profile Images */
.friend-request-item img, .friend-item img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 2px solid #f7c45d;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    margin-right: 10px;
}

/*  Username Text */
.friend-request-item span, .friend-item span {
    flex-grow: 1;
    font-size: 18px;
    font-weight: bold;
    color: #fff;
}

/*  Accept & Decline Buttons */
.friend-request-item button {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 5px;
    cursor: pointer;
    margin-left: 8px;
    transition: background 0.3s ease-in-out, transform 0.2s ease-in-out;
}

.friend-request-item button:hover {
    background: #218838;
    transform: scale(1.05);
}

.friend-request-item button.decline {
    background: #dc3545;
}

.friend-request-item button.decline:hover {
    background: #c82333;
}

/*  Scrollbar Styling */
#friendRequestsList::-webkit-scrollbar, #friendsList::-webkit-scrollbar {
    width: 8px;
}

#friendRequestsList::-webkit-scrollbar-thumb, #friendsList::-webkit-scrollbar-thumb {
    background: #f7c45d;
    border-radius: 10px;
}

#friendRequestsList::-webkit-scrollbar-track, #friendsList::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
}

/*  Mobile Responsive */

/* 🔥 Sidebar Profile Section */
.sidebar-profile {
    text-align: center;
    padding: 15px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
}

.sidebar-profile img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid white;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.sidebar-profile h3 {
    margin: 10px 0 5px;
    color: goldenRod;
    font-size: 30px;
    font-weight: bold;
    box-shadow: 12 20 10px rgba(255, 255, 0, 0.8);
}

.sidebar-profile p {
    font-size: 28px;
    color: #ccc;
    font-style: italic;
    
}

/* Sidebar Hidden Initially */
/*  Futuristic Sidebar */
#sidebar {
position: fixed;
    top: -10px;
    left: -10px; /* Start Off-Screen */
   width: 500px;
    height: 150%;
    background: linear-gradient(135deg, #7f00ff, #e100ff);
    box-shadow: 0 0 20px rgba(255, 0, 255, 0.5);
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: left 0.6s ease-in-out;
    padding-top: 60px;
    z-index: 1500;
    border-top-right-radius: 20px;
    border-bottom-right-radius: 20px;
    display: none; /* Initially hidden */
    transform: translateX(-100%);
    transition: transform 0.3s ease-in-out;
    animation: flicker 1.5s infinite alternate;
}
#sidebar.active {
    display: block; /* Show the sidebar */
    transform: translateX(0); /* Slide in */
}
/*  Sidebar Open Animation */
@keyframes slideIn {
    0% { left: -400px; opacity: 0; }
    80% { left: 5px; opacity: 1; }
    100% { left: 0; }
}

#sidebar.active {
    animation: slideIn 0.6s ease-out;
    left: 0;
}

/*  Sidebar Particle Background */
#sidebar::before {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 10%, transparent 80%);
    opacity: 0.5;
    animation: moveParticles 10s infinite;
    z-index: -1;
}

@keyframes moveParticles {
    0% { transform: translateY(0px); }
    50% { transform: translateY(10px); }
    100% { transform: translateY(0px); }
}

/*  Flickering Glow */
@keyframes flicker {
    0% { box-shadow: 0 0 5px rgba(255, 0, 255, 0.3); }
    100% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.8); }
}

/*  Sidebar Buttons */
.sidebar-btn {
    position: relative;
    width: 100%;
    padding: 15px;
    color: white;
    background: none;
    font-size: 18px;
    cursor: pointer;
    text-align: left;
    transition: all 0.3s ease-in-out;
    text-transform: uppercase;
    letter-spacing: 2px;
}

.sidebar-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 10px #e100ff, 0 0 20px #7f00ff;
    transform: scale(1.05);
}

/*  Animated Sidebar Icons */
.sidebar-btn i {
    transition: transform 0.4s ease;
}

.sidebar-btn:hover i {
    transform: rotate(360deg);
}

/*  3D Hover Effect on Buttons */
.sidebar-btn {
    transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
}

.sidebar-btn:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(255, 255, 255, 0.4);
}

/*  Logout Button Fixed at Bottom */
.logout-container {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    text-align: center;
}


/* 🔥 Logout Button */
.logout-button {
    width: 25%;
    padding: 15px;
    background: linear-gradient(135deg, #FF416C, #FF4B2B);
    color: white;
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s ease-in-out, transform 0.2s ease;
}

/* 🔄 Icon Animation */
.logout-button i {
    margin-right: 10px;
    font-size: 22px;
    transition: transform 0.3s ease-in-out;
}

/* 🚀 Hover Effect */
.logout-button:hover {
    background: linear-gradient(135deg, #FF2A5C, #D72638);
    transform: scale(1.05);
}

/* 🔄 Click Animation */
.logout-button:active i {
    transform: rotate(360deg);
}

/* 🔥 Logout Fade Animation */
@keyframes logoutFade {
    0% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
    100% { opacity: 0; transform: scale(0); }
}

/* Sidebar Buttons */
.sidebar-btn {
    display: block;
    width: 100%;
    padding: 15px;
    background: none;
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
    text-align: left;
    transition: background 0.3s ease-in-out;
}

.sidebar-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* Menu Button (☰) */
#menuBtn {
    width: 65px;
    height: 65px;
    background: linear-gradient(135deg, #007BFF, #0056b3);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

#menuBtn:hover {
    background: linear-gradient(135deg, #ffb199, #ff655b);
    transform: scale(1.1);
}

/* Floating Action Button (FAB) */
/* Floating Action Button (FAB) */
/* Sidebar Floating Button */
.fab {
    display: flex;
    align-items: center;
    justify-content: center;
    /* Full width inside sidebar */
    
    font-size: 18px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s ease-in-out, transform 0.2s ease;
}

.fab i {
    margin-right: 10px; /* Space between icon and text */
    font-size: 22px;
}

.fab:hover {
    background: linear-gradient(135deg, #0056b3, #003d80);
    transform: scale(1.05);
}
/* Hover Animation */

.message-options {
    position: relative;
    display: inline-block;
    margin-left: 10px;
    cursor: pointer;
    font-size: 18px;
    color: white;
}

.message-menu {
    display: none;
    position: absolute;
    top: 20px;
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 5px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    z-index: 1000;
}

.message-menu button {
    display: block;
    width: 100%;
    background: none;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    font-size: 14px;
    color: black;
}

.message-menu button:hover {
    background: #f0f0f0;
}


#back-to-search {
    display: block;
    text-align: center;
    width: 100%;
    margin-top: 15px;
    padding: 10px;
    border-radius: 8px;
    background: linear-gradient(135deg, #ff9a9e, #fad0c4);
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}

#back-to-search:hover {
    transform: scale(1.05);
}
.message-box label {
    cursor: pointer;
    font-size: 18px;
    color: #ffcc00;
    transition: transform 0.3s;
}
#chat-section {
    width: 100%;
    max-width: 800px;
    margin: 20px auto;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(0px);
    padding: 20px;
    border-radius: 10px;
    transition: background 0.3s ease-in-out;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
}
/* Theme Dialog Box */
.dialog {
    display: none; /* Default: Hidden */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
}

.theme-selection {
    background: #ccc;
    padding: 20px;
    border-radius: 10px;
    width: 50%;
    max-width: 600px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    text-align: center;
}

#joinedUsersList {
    max-height: 600px; /* Adjust height as needed */
    overflow-y: auto; /* Enables vertical scrolling */
    border: 1px solid #ddd; /* Optional: Border for better visibility */
    padding: 10px;
    background: #f9f9f9;
    border-radius: 8px;
}

.manage-group-user {
margin-left: 60px;
  margin-top: -40px;
}
.kick {
   width: 120px;
scale: 0.9;
   margin-left: 580px;
    margin-top: -50px;
   font-size: 20px;
}
.block-btn {
	width: 120px;
    scale: 0.9;
   margin-left: 580px;
   margin-top: -10px;
   font-size: 20px;
}
body.dark-theme {
    background-color: black; /* Current dark background */
    color: white;
}
body.dark-theme {
    background-color: black;
    color: white;
}

/* Buttons in dark theme */
body.dark-theme button {
    background-color: #333;
    color: white;
}

body.dark-theme .modal-content {
    background-color: #333;
    color: white;
}
/* Toggle Switch Styling */
    .Dark-Mode-container {
      padding: 30px;
    }

    .Dark-Mode-box {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .toggle-label {
      font-size: 18px;
    }

    .theme-toggle {
      position: relative;
      width: 50px;
      height: 25px;
    }

    .theme-toggle input {
      display: none;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 25px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 19px;
      width: 19px;
      left: 5px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #007BFF;
    }

    input:checked + .slider:before {
      transform: translateX(22px);
    }
body.dark-theme input, body.dark-theme textarea {
    background-color: #555;
    color: white;
    border: 1px solid #444;
}

body.dark-theme ::placeholder {
    color: lightgray;
}

/* Ensure dialogue boxes (modals) follow the dark theme */
body.dark-theme .modal {
    background-color: rgba(0, 0, 0, 0.8);
}

body.dark-theme .modal-content {
    background-color: #222;
    color: white;
}
.theme-toggle input {
    display: none;
}
.search-friends, .notifications, #groupslist, #yourGroupsList, #joinedGroupsList {
    background-color: white;  /* White background for search sections */
    color: black;
}
.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 25px;
}
body.dark-theme #manageGroupBox {
    background-color: #333;
    color: white;
}
.slider:before {
    position: absolute;
    content: "";
    height: 19px;
    width: 19px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #007BFF; /* Blue when toggled */
}

input:checked + .slider:before {
    transform: translateX(25px); /* Moves the toggle button */
}

#manageGroupBox {
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 10px;
    background-color: #fff;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    margin: 20px auto;
    max-width: 800px;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

#search-section {
    animation: bounceIn 0.8s ease-out;
}
button, .input-group input, .message .content {
    transition: all 0.3s ease-in-out;
}

@keyframes bounceIn {
    0% {
        transform: scale(0.5);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
        opacity: 1;
    }
    100% {
        transform: scale(1);
    }
}

::-webkit-scrollbar {
    width: 8px;
}
::-webkit-scrollbar-track {
    background: #f4f4f4;
    border-radius: 10px;
}
::-webkit-scrollbar-thumb {
    background: #007BFF;
    border-radius: 10px;
}
::-webkit-scrollbar-thumb:hover {
    background: #0056b3;
}
body.dark-theme .search-friends, body.dark-theme .notifications, body.dark-theme #groupslist, 
body.dark-theme #yourGroupsList, body.dark-theme #joinedGroupsList {
    background-color: black;  /* Black background for search sections */
    color: white;  /* White text */
}

/* Buttons in Dark Theme */
body.dark-theme button {
    background-color: #333;
    color: white;
}

body.dark-theme button:hover {
    background-color: #444;
}

/* Input Fields in Dark Theme */
body.dark-theme input, body.dark-theme textarea {
    background-color: #555;
    color: white;
    border: 1px solid #444;
}
body.dark-theme input::placeholder, body.dark-theme textarea::placeholder {
    color: lightgray;
}

/* Dark Theme Modal */
body.dark-theme .modal-content {
    background-color: #333;
    color: white;
}

/* Modal Background */
body.dark-theme .modal {
    background-color: rgba(0, 0, 0, 0.8);
}
button:active {
    position: relative;
    overflow: hidden;
}

button:active::after {
    content: '';
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    background: rgba(255, 255, 255, 0.4);
    border-radius: 50%;
    animation: ripple 0.6s ease-out;
}
body.dark-theme a {
    color: #00BFFF;
}

body.dark-theme a:hover {
    color: #00A1CC;
}
#theme-toggle {
    position: fixed;
    top: 10px;
    right: 10px;
    background-color: #007bff;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    z-index: 1000;
}
body.dark-theme #yourGroupsList{
    background-color: #333;
    color: white;
}
body.dark-theme #groupslist{
    background-color: #333;
    color: white;
}
body.dark-theme #joinedGroupsList{
    background-color: #333;
    color: white;
}
body.dark-theme .group-item{
    background-color: #333;
    color: white;
}
@keyframes ripple {
    0% { width: 0; height: 0; opacity: 1; }
    100% { width: 200px; height: 200px; opacity: 0; }
}

.group-details {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.group-details img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
}
#joinedGroupsList {
max-width: 800px; /* Maximum width of the container */
    min-width: 300px; /* Minimum width of the container */
    overflow-y: auto; /* Enable vertical scrolling */
    max-height: 450px; /* Set a max height so scrolling is needed if content exceeds this height */
    padding: 10px; /* Optional: for spacing around the content */
    margin: 0 auto; /* Center the content horizontally */
    padding-bottom: 80px;
    max-height: 450px;
    min-height: 200px;
}
        #chatGroupSection .message {
    display: flex;
    margin-bottom: 10px;
    animation: fadeInUp 0.5s ease-in-out;
}

#chatGroupSection .message img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin-right: 10px;
}

#chatGroupSection .message .content {
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 1.1em;
    color: green;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
}

/* Sender Styles */
#chatGroupSection .message.sent .content {
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: #fff;
}

#chatGroupSection .message.sent .username {
    color: red;
    font-weight: bold;
    margin-bottom: 5px;
}

/* Receiver Styles */
#chatGroupSection .message.received .content {
    background: linear-gradient(135deg, #32de84, #228b22);
    color: #000;
}

#chatGroupSection .message.received .username {
    color: green;
    font-weight: bold;
    margin-bottom: 5px;
}
#send-btn {
      width: 30px;
       height: auto;
}
#yourGroupList {
    max-width: 800px; /* Maximum width of the container */
    min-width: 300px; /* Minimum width of the container */
    overflow-y: auto; /* Enable vertical scrolling */
    height: 650px; /* Set a max height so scrolling is needed if content exceeds this height */
    padding: 10px; /* Optional: for spacing around the content */
    margin: 0 auto; /* Center the content horizontally */
}

.group-item {
    border: 1px solid #ccc; /* Optional: add border to each group item */
    margin-bottom: 10px; /* Space between each group item */
    padding: 10px; /* Space inside each group item */
    background-color: #f9f9f9; /* Optional: background color for group items */
}

send-btn {
	width: 50px;
	}
#groupList {
    max-height: 1100px;  /* Maximum height, adjust as needed */
    max-width: 90%;    /* Maximum width, you can change this based on your design */
    padding: 10px;      /* Optional: Add padding for spacing */
    overflow-y: auto;   /* Enables vertical scrolling if content exceeds max height */
    overflow-x: hidden; 
    background: #1e1e2f;
    border: 2px dotted #ddd; /* Optional: Add a border around the list */
    border-radius: 8px;  /* Optional: Rounded corners for the list container */
}

.group-item {
    border-top: 2px solid #ddd;  /* Border at the top of each group item */
    border-bottom: 2px solid #ddd; /* Border at the bottom of each group item */
    padding: 10px;                /* Padding around each group */
    background-color: #f9f9f9;    /* Optional: Background color for group items */
    border-radius: 8px;           /* Optional: Rounded corners for group items */
    margin-bottom: 10px;          /* Margin between group items */
}

.group-item:first-child {
    border-top: 2px solid #ddd; /* Ensures first item has top border too */
}

.group-item:last-child {
    border-bottom: 2px solid #ddd; /* Ensures last item has bottom border too */
}

#groupslist h3 {
    font-size: 24px;
    margin-bottom: 20px;
}

/* Circle Style for Group and Creator Icons */
.group-item img {
    width: 50px;             /* Fixed size for the icons */
    height: 50px;            /* Fixed size for the icons */
    border-radius: 50%;      /* Makes the icon circular */
    object-fit: cover;       /* Ensures the image fills the circle without distortion */
    margin-right: 10px;      /* Space between the icon and text */
}

.group-item .creator-icon {
    width: 50px;             /* Smaller icon for creator */
    height: 50px;            /* Smaller icon for creator */
}

.group-item img.creator-icon {
    margin-right: 5px;
}

#fullViewModal {
    display: none;
    position: fixed;
    top: -50%;
    left: 50%;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, -50.0);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

#fullViewModal .modal-content {
    background: #fff;
    padding: 10px;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    text-align: center;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

#fullViewModal img {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    border-radius: 8px;
}
#fullViewModal .close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    cursor: pointer;
    color: red;
}

.attachment-image img{
    width: 400px; /* Set fixed width */
    height: 3px; /* Set fixed height */
    object-fit: cover; /* Ensure proper scaling without distortion */
    border-radius: 5px; /* Remove the circular shape */
    margin-top: 10px; /* Add spacing for better layout */
}

/* Styling for Video Attachments */
.attachment-video {
    width: 100px; /* Adjust width */
    height: 50px; /* Automatically calculate height for aspect ratio */
    margin-top: 0px;
    border-radius: 0; /* Remove circular shape */
}

/* Styling for Audio Attachments */
.attachment-audio {
    width: 150%; /* Full width of container */
    border-radius: 2px; /* Remove circular shape */
}

/* Downloadable Files */
.attachment-link {
    display: inline-block;
    margin-top: 10px;
    color: #007BFF;
    text-decoration: none;
    font-size: 14px;
}

.attachment-link:hover {
    text-decoration: underline;
}
    .container {
          max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
    }
        section {
            display: none;
        }
        section.active {
            display: block;
        }
        input, button {
            display: block;
            width: 100%;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007BFF;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .messages {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            height: 900px;
            overflow-y: auto;
            object-fit: cover;
            background: #f9f9f9;
            scroll-behavior: smooth;
   box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.3);
        background: rgba(0, 0, 0, 0.5);
        }
        .message {
            display: flex;            
            margin-bottom: 10px;
            animation: fadeInUp 0.5s ease-in-out;
        }
        .message img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .message.received {
    justify-content: flex-start;
    width: 65%;
    margin-right: auto;
}

/* Received = friend's message on the right */
.message.sent {
    justify-content: flex-end;
    width: 65%;
    margin-left: auto;
}
.message.sent .username {
    color: red;
    font-weight: bold;
      margin-bottom: 5px;
}

.message.received .username {
    color: orange;
    font-weight: bold;
     margin-bottom: 5px;
}

        .message .content {
        padding: 10px 20px;
        font-size: 1.1em;
        background: rgba(0, 0, 0, 0.6);
        color: #fff;
        max-width: 100%;
        word-wrap: break-word;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .message.sent .content {
        background: linear-gradient(135deg, #007bff, #0056b3);
            color: #fff;
          border-bottom-left-radius: 50px;
      	border-top-right-radius: 50px;
        }
        .message.received .content {
            background: linear-gradient(135deg, #32de84, #228b22);
            color: #000;
            border-bottom-right-radius: 50px;
      	border-top-left-radius: 50px;
        }
        .message-box {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .message-box input {
            display: block;
            width: 88%;
            margin-bottom: 15px;
            padding: 10px;
            border: 2px solid #000;
            border-radius: 5px;
}

        .message-box button {
            padding: 5px;
            font-size: 16px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .message-box button:hover {
            background: #0056b3;
        }
        section {
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all 0.4s ease-in-out;
}

section.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}
.hidden {
	opacity: 0;
	}

.toggle-link {
    color: #007BFF;
    cursor: pointer;
    text-decoration: underline;
    font-size: 0.9em;
    text-align: center;
}

.toggle-link:hover {
    color: #0056b3;
}
.flex-container {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    background: #aaa;
}

.notifications, .search-friends {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

.notifications {
max-width: 300px;
    min-width: 300px;
    overflow-y: auto;
    max-height: 300px;
margin: 0 auto;
padding: 10px;
}

.search-friends {
    max-width: 60%;
}
/* Modal Styles */
.modal-content {
    background: #fff;
    margin-top: 0px;
    padding: 30px;
    animation: fadeIn 0.5s ease-in-out;
    border-radius: 10px;
    text-align: bottom;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.9);
    width: 900px; /* Increase width */
    max-width: 100%; /* Ensure it adapts to smaller screens */
    min-height: 200px; /* Add minimum height */
}

.modal {
    display: none;
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translate(-50%, 50%);
    background: #fff;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    z-index: 1000;
}

/* Close Button Styles */
#closeModal {
    position: absolute; /* Absolute positioning for the close button */
    top: 1340px; 
    
    right: -580px; 
    color: white;
   color: red;
    font-size: 50px;
    font-weight: bold;
    cursor: pointer;
    z-index: 2; /* Keep it above the modal content */
}
.close {
position: absolute; /* Absolute positioning for the close button */
    top: 10px; /* Position from the top */
    right: 0px; /* Position from the right */
   color: red;
    font-size: 50px;
    font-weight: bold;
    cursor: pointer;
    z-index: 2; /* Keep it above the modal content */
}


/* Modal Image */
.modal-content img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Ensure the image is fully visible without distortion */
}
button {
        background: linear-gradient(135deg, #ff7eb3, #ff758c);
        color: #fff;
        font-size: 1.2em;
        font-weight: bold;
        border: none;
        padding: 15px 30px;
        margin: 10px 0;
        border-radius: 25px;
        box-shadow: 0 5px 15px rgba(255, 118, 138, 0.5);
        transition: all 0.3s ease-in-out;
        cursor: pointer;
    }

    button:hover {
        transform: translateY(-5px) scale(1.05);
        background: linear-gradient(135deg, #ffb199, #ff655b);
        box-shadow: 0 10px 20px rgba(255, 101, 91, 0.7);
    }
   .create-button {
            position: fixed;
            bottom: -1100px;
            right: 0px;
            width: 100px;
            height: 100px;
            background-color: #007BFF;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 1000;
        }

.btn {
        background: linear-gradient(135deg, #7f00ff, #e100ff);
        color: #fff;
        border: none;
        padding: 15px 30px;
        border-radius: 25px;
        transition: all 0.4s ease-in-out;
        box-shadow: 0 5px 15px rgba(113, 0, 255, 0.5);
        font-size: 1.2em;
    }

    .btn:hover {
        background: linear-gradient(135deg, #e100ff, #7f00ff);
        box-shadow: 0 10px 25px rgba(113, 0, 255, 0.8);
        transform: translateY(-5px) scale(1.05);
    }

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.input-group {
    position: relative;
    margin-bottom: 15px;
}

.input-group input {
    width: 100%;
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 25px;
    outline: none;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    font-size: 14px;
}

.input-group input:focus {
    border-color: #2575fc;
    box-shadow: 0 0 8px rgba(37, 117, 252, 0.5);
}

.toggle-password {
    position: absolute;
    right: 50px;
    top: 59%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #aaa;
    transition: color 0.3s ease;
}

.toggle-password:hover {
    color: #2575fc;
}
.icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 0 20px #fff, 0 0 40px #0ff, 0 0 60px #0ff;
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .icon:hover {
            transform: scale(1.2);
            box-shadow: 0 0 30px #ff0, 0 0 50px #ff0, 0 0 70px #ff0;
        }
    .txt {
    	    position: absolute;
             top: 40px;
             left: 360px;
            text-align: center;
            font-size: 2.5em;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 5px;
            animation: motion 3s infinite ease-in-out, colorChange 5s infinite linear, shadowPulse 5s infinite linear;
        }
        @keyframes motion {
            0% {
                transform: scale(1) translateY(0);
            }
            25% {
                transform: scale(1.2, 1.4) translateY(-15px);
            }
            50% {
                transform: scale(1.4, 1.2) translateY(15px);
            }
            75% {
                transform: scale(1.2, 1.4) translateY(-1px);
            }
            100% {
                transform: scale(1) translateY(0);
            }
        }
        @keyframes colorChange {
            0% {
                color: #ff0000;
            }
            25% {
                color: #00ff00;
            }
            50% {
                color: #0000ff;
            }
            75% {
                color: #ffff00;
            }
            100% {
                color: #ff0000;
            }
        }
        @keyframes shadowPulse {
            0% {
                text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            }
            25% {
                text-shadow: 0 0 5px #00ff00, 0 0 15px #00ff00, 0 0 25px #00ff00, 0 0 35px #00ff00;
            }
            50% {
                text-shadow: 0 0 10px #0000ff, 0 0 20px #0000ff, 0 0 30px #0000ff, 0 0 40px #0000ff;
            }
            75% {
                text-shadow: 0 0 15px #ffff00, 0 0 25px #ffff00, 0 0 35px #ffff00, 0 0 45px #ffff00;
            }
            100% {
                text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            }
        }
          .star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: twinkle 5s infinite ease-in-out;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 3; }
        }

        /* Comets */
        .comet {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 20px 5px rgba(255, 255, 255, 0.9);
            animation: cometMove 10s linear infinite;
        }

        @keyframes cometMove {
            from { transform: translate(0, 0) scale(1); opacity: 1; }
            to { transform: translate(-100vw, 100vh) scale(0.5); opacity: 0; }
        }
        @keyframes ring {
    0% { transform: rotate(0); }
    15% { transform: rotate(-35deg); }
    30% { transform: rotate(25deg); }
    45% { transform: rotate(-25deg); }
    60% { transform: rotate(25deg); }
    75% { transform: rotate(-100deg); }
    100% { transform: rotate(0); }
}

/* Bell default style */
.bell {
    font-size: 50px;
    cursor: pointer;
    position: absolute;
    top: 10px;   /* Adjust to your preference */
    left: 15px;  /* Moves it to the left */
    color: white;
}

/* Apply animation when clicked using :active */
.bell:active i {
    animation: ring 0.5s ease-in-out 3;
}
    .send-btn {
      position: absolute;
      right: 2px;
      background: #ccc;
      color: white;
      border-radius: 50%;
      padding: 10px;
      font-size: 20px;
      cursor: not-allowed;
      transition: all 0.3s ease;
    }

    .send-btn.active {
      background: #000;
      color: #fff;
      cursor: pointer;
    }
        .containor {
      background-color: #fff;
      border-radius: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.35);
      position: relative;
      overflow: hidden;
      top: 120%;
      left: 50%;
      transform: translate(-50%, -0%);
      width: 900px;
      max-width: 100%;
      height: 650px;
    }

    /* Keep the rest of your original styles below */
    .containor p {
      font-size: 14px;
      line-height: 30px;
      letter-spacing: 0.3px;
      margin: 20px 0;
    }

    .container span {
      font-size: 12px;
    }

    .containor a {
      color: #333;
      font-size: 13px;
      text-decoration: none;
      margin: 15px 0 10px;
    }

    .containor button {
      background-color: #2da0a8;
      color: #fff;
      font-size: 12px;
      padding: 10px 45px;
      border: 1px solid transparent;
      border-radius: 8px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-top: 10px;
      cursor: pointer;
    }

    .containor button.hidden {
      background-color: transparent;
      border-color: #fff;
    }

    .containor form {
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 0 40px;
      height: 100%;
    }

    .containor input {
      background-color: #eee;
      border: none;
      margin: 8px 0;
      padding: 10px 15px;
      font-size: 13px;
      border-radius: 8px;
      width: 100%;
      outline: none;
    }

    .form-container {
      position: absolute;
      top: 0;
      height: 100%;
      transition: all 0.6s ease-in-out;
    }

    .sign-in {
      left: 0;
      width: 50%;
      z-index: 2;
    }

    .containor.active .sign-in {
      transform: translateX(100%);
    }

    .sign-up {
      left: 0;
      width: 50%;
      opacity: 0;
      z-index: 1;
    }

    .containor.active .sign-up {
      transform: translateX(100%);
      opacity: 1;
      z-index: 5;
      animation: move 0.6s;
    }

    @keyframes move {
      0%, 49.99% {
        opacity: 0;
        z-index: 1;
      }

      50%, 100% {
        opacity: 1;
        z-index: 5;
      }
    }

    .social-icons {
      margin: 20px 0;
    }

.social-icons a {
  border: 1px solid #ccc;
  border-radius: 50%;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  margin: 0 3px;
  width: 40px;
  height: 40px;
}

    .toggle-container {
      position: absolute;
      top: 0;
      left: 50%;
      width: 50%;
      height: 100%;
      overflow: hidden;
      transition: all 0.6s ease-in-out;
      border-radius: 150px 0 0 100px;
      z-index: 1000;
    }

    .containor.active .toggle-container {
      transform: translateX(-100%);
      border-radius: 0 150px 100px 0;
    }

    .toggle {
      background-color: #2da0a8;
      height: 100%;
      background: linear-gradient(to right, #5c6bc0, #2da0a8);
      color: #fff;
      position: relative;
      left: -100%;
      height: 100%;
      width: 200%;
      transform: translateX(0);
      transition: all 0.6s ease-in-out;
    }

    .containor.active .toggle {
      transform: translateX(50%);
    }

    .toggle-panel {
      position: absolute;
      width: 50%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 0 30px;
      text-align: center;
      top: 0;
      transform: translateX(0);
      transition: all 0.6s ease-in-out;
    }

    .toggle-left {
      transform: translateX(-200%);
    }

    .containor.active .toggle-left {
      transform: translateX(-10%);
    }

    .toggle-right {
      right: -10px;
      transform: translateX(5%);
    }

    .containor.active .toggle-right {
      transform: translateX(20%);
    }
.chatting-with {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 10px 0 20px;
}

.signup #signup-password {
	margin-top: -10%;
	}

.friend-info {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 28px;
    font-weight: bold;
}

.profile-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
}

.call-buttons {
    display: flex;
    gap: 10px;
}

.call-buttons button {
    border: none;
    font-size: 24px;
    cursor: pointer;
    background: linear-gradient(135deg, #6e45e2, #88d3ce);
    color: #333;
    box-shadow: none;
}

.call-buttons button:hover {
    color: #007bff;
}

@keyframes loadingAnimation {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.spinner {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: loadingAnimation 1s linear infinite;
}
    </style>
</head>
<body>
 <div class="solar-system">
	</div>
<img src="icon/ChatWithUs.jpg" class="icon"alt="icon"><h1 class="txt">CHAT_WITH_US</h1>

<div class="container">
    <!-- Authentication Section -->
    <section id="auth-section" class="active">
        <!-- Buttons to Open Modals -->
  <div class="containor" id="container">
    <div class="form-container sign-up">
      <form>
        <div class="signUp-profile-upload-wrapper" onclick="document.getElementById('profile-icon').click()">
  <img src="default-profile.png" id="signUp-profile-preview" alt="ProfileIcon">
</div>
<input type="file" id="profile-icon" accept="image/*" style="display: none;" onchange="previewProfileIcon(event)">

       <input type="text" id="signup-username" placeholder="Enter Username">
      <input type="password" id="signup-password" placeholder="Enter Password">
  <i class="toggle-password fas fa-eye" onclick="togglePassword('signup-password', this)"></i>

<button id="signup-btn" class="btn">  <i class="fas fa-user-plus"></i>Sign up</button>
      </form>
    </div>
    <div class="form-container sign-in">
      <form>
        <h1 style="color: purple;">Login</h1>
        <div class="social-icons">
          <a href="#" class="icon"><i class="fa-brands fa-google-plus-g"></i></a>
          <a href="#" class="icon"><i class="fa-brands fa-facebook-f"></i></a>
          <a href="#" class="icon"><i class="fa-brands fa-github"></i></a>
          <a href="#" class="icon"><i class="fa-brands fa-linkedin-in"></i></a>
        </div>
        <span>Enter your username and password</span>
         <input type="text" id="login-username" placeholder="Enter Username">
                    <input type="password" id="login-password" placeholder="Enter Password">
                    <i class="toggle-password fas fa-eye" onclick="togglePassword('login-password', this)"></i>
        <a href="#">Forget Your Password?</a>
        <button id="login-btn" class="btn" aria-label="Login">Login</button>
      </form>
    </div>
    <div class="toggle-container">
      <div class="toggle">
        <div class="toggle-panel toggle-left">
          <h1>Welcome</h1>
          <p>Enter your personal details to use all of site features</p>
          <button style="background: none; box-shadow: none; border: 2px dotted white; width: 200px; white-space: no-wrap;" id="login">LOGIN</button>
        </div>
        <div class="toggle-panel toggle-right">
          <h1>Hello, Friend!</h1>
          <p>Register with your username and password details to use all of site features</p>
          <button style="background: none; box-shadow: none; border: 2px dotted white; width: 200px; white-space: no-wrap;" id="register">Sign Up</button>
        </div>
      </div>
    </div>
  </div>
    </section>

    <!-- Search Section -->
    <section id="search-section">
<!-- Sidebar Menu -->
<div id="sidebar">
<!-- User Profile Section in Sidebar -->

<div class="sidebar-profile">

    <img class="manage-profile" id="profile-pic" src="default-user.png" alt="Profile">
    <h3 id="profile-name">Loading...</h3>
    <p id="profile-email">#user@ChatWithUs.com</p>
</div>
<button id="public-groups-btn" class="SideBarBtns"><i class="fas fa-users"></i> Public Groups</button> 

<button class="SideBarBtns" id="friendRequestsBtn">Notifications <i class="fas fa-bell"></i>
</span>
</button>
<button class="SideBarBtns" id="friendsBtn"><i class="fas fa-user"></i> Friends</button> 
    <button class="SideBarBtns" id="openManageGroups" class="sidebar-btn">Manage your Groups</button>
<!-- Logout Button at the Bottom -->
<div class="logout-container">
    <button id="logout-btn" class="logout-button">
        <i class="fas fa-sign-out-alt"></i> Logout
    </button>
</div>
<div id="updateInfo" style="
    position: absolute;
    bottom: 0px;
    right: 10px;
    font-size: 14px;
    color: white;
    background: #333;
    padding: 5px 10px;
    border-radius: 5px;
    opacity: 0.8;">
    Lastest released update -> 4.0
</div>

</div>
<button id="createGroupBtn" class="btn"><i class="fas fa-plus"></i></button>
<!-- Sidebar Toggle Button (☰) -->
<button id="menuBtn">&#9776;</button>

    <div class="flex-container">
        <!-- Notifications Section -->
        <div class="notifications">
            <h3>Notification/Friends</h3>
            <div id="notifications-list">
                <p>No new messages or friends</p>
            </div>
        </div>

        <!-- Search Friends Section -->
        <div class="search-friends">
            <h3>Search Friends</h3>
            <input type="text" id="search-user" placeholder="Enter Username to Search">
            <button id="search-btn">Search</button>
            <div id="user-search-result"></div>
        </div>
    </div>

<!-- Create Group Modal -->
<div id="createGroupModal" class="modal">
    <div class="modal-content">
        <h2>Create Group</h2>
        <div class="input-group">
            <input type="text" id="group-name" placeholder="Enter Group Name">
        </div>
        <div class="input-group">
            <input type="file" id="group-icon" accept="image/*">
        </div>
        <div class="input-group">
            <textarea id="group-description" placeholder="Enter Group Description" rows="3"></textarea>
        </div>
        <div class="input-group">
            <select id="group-privacy">
                <option value="public">Public</option>
                <option value="private">Private</option>
            </select>
        </div>
        <button id="createGroupSubmit" class="btn">Create</button>
        <button class="closeModal btn">Close</button>
    </div>
</div>

<div class="joined-groups">
    <h3>Joined Groups</h3>
    <div id="joinedGroupsList">
        <p>Loading joined groups...</p>
    </div>
</div>

<!-- Create Group Button -->
</section>

<section id="yourGroups">
	<button style="margin-left:
0px; height: 70px; width: 70px;" id="backToGroups"><-</button>
<div id="yourGroupsList">
    <h3>Your Groups</h3>
    <div id="yourGroupList">
        <p>Loading your groups...</p>
    </div>
</div>
</section>

<!-- Manage Group Section -->
<section id="manageGroupBox">
    <button style="margin-left:
0px; height: 70px; width: 70px;" id="backToGroupsBtn"><-</button>
<div id="blockedUsersModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span style="font-size: 50px;" id="closeBlockedUsersModal" class="close">&times;</span>
        <h2>Blocked Members</h2>
        <div id="blockedUsersList">
            <p>Loading blocked Members...</p>
        </div>
    </div>
</div>

    <h2>Manage Group</h2>
    <span id="groupDetails">
<button id="blockedUsersBtn" class="group-btn">Blocked Users</button>
        <p><strong>Group Name:</strong> <span id="manageGroupName"></span></p>
        <p><strong>Created by:</strong> <span id="manageGroupCreator"></span></p>
        <div id="manageGroupLikes"></div>
        
    </span>
    <h3>Joined Users</h3>
    <ul id="joinedUsersList"></ul>
</section>

<!-- group chat -->
<section id="chat-group-section"> 
	    <div id="group-details" style="margin-bottom: 15px;">
        <img id="groupIcon" src="default-group-icon.png" alt="Group Icon" style="width: 50px; height: 50px; border-radius: 50%;">
        <h2 id="groupName"></h2>
    </div>
<div class="three-dots-container">
    <button id="group-sideBar-btn" class="group-sidebar-btn"><i class="fas fa-cog" style="cursor: pointer;"></i></button>
</div>
    <h2>Group Chat</h2>
    <div class="messages" id="groupmessages"></div>
    <div class="message-box">
        <input class="message-input" type="text" id="group-message-input" placeholder="Type your message here">
        <div class="send-btn" id="group-send-btn"><i class="fas fa-paper-plane"></i></div>
    </div> 
<button id="back">back</button>
</div>
</section>


  <section id="group-settings">
    <!-- Header -->
    <div class="group-header">
      <div class="header-top">
        <div class="group-info">
          <img id="settingsGroupIcon" src="default-group-icon.png" alt="Group Icon" />
          <div class="group-details">
            <h2 id="settingsGroupName">Group Name</h2>
          </div>
        </div>
        <div class="button-group">
          <button id="fetchfriendsBtn" class="btn btn-invite"><i class="fa-solid fa-user-plus invite-icon"></i></button>
          <button style="background: none; border: none; box-shadow: none; width: 80px; height: 80px;" id="back-to-chat" class="btn btn-back"><i style="font-size: 50px;" class="fas fa-close"></i></button>
        </div>
      </div>
      <div class="group-meta">
        <p><strong>Description:</strong> <span id="settingsGroupDescription"></span></p>
        <p><strong>Privacy:</strong> <span id="settingsGroupPrivacy"></span></p>
        <p><strong>Created by:</strong> <span id="settingsGroupAdmin"></span></p>
      </div>
    </div>

    <!-- Footer -->
    <div class="group-footer">
      <h3>Group Members</h3>
      <div id="groupMembersContainer" class="members-grid">
        <!-- Example Members -->
        <div class="member-card">
        	<span class="member-info">
          </span>
        </div>
        <div class="member-card">
        	<span class="member-info">
          </span>
        </div>
        <!-- More member cards can be dynamically added -->
      </div>
    </div>
      <div id="leaveGroupButtonContainer"></div>
  </section>

<section id="public-group-section"> 
<div id="groupslist">
<button style="margin-left:
0px; height: 70px; width: 70px;" id="back-search"><-</button>
    <h3>Public Group List</h3>
    	    <input type="text" id="search-public-group" placeholder="Search groups..." style="width: 50%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd;">
    <div id="groupList">
        <p>Loading public groups...</p>
    </div>
</div>
</section>
<section id="friendRequestsSection">
	<button style="margin-left:
0px; height: 70px; width: 70px;" class="back-btn" onclick="goBackToSearch()"><-</button>
	    <div class="fetch-container">
    <h2>Friend Requests</h2>
    <div id="friendRequestsList"></div>
        </div>
        <div class="invite-container">
    <h3>Group Invitations</h3>
    <ul id="inviteList"></ul>
    </div>
</section>
<section id="friendsListSection" class="friends-list-section">
	<button style="margin-left:
0px; height: 70px; width: 70px;"  class="back-btn" onclick="goBackToSearch()"><-</button>
<button id="blockedFriendsbtn"
    style="border: none; margin-top: -60px; margin-left: 640px; width: 150px; height: 60px; white-space: nowrap; overflow: hidden; font-size: 15px;">
    Blocked Friends
</button>
    <h2>Your Friends</h2>
    <div id="friendsList"></div>
</section>

    <!-- Chat Section -->
    <section id="chat-section">
<div id="chatting-with" class="chatting-with">
    <div class="friend-info">
        <img id="chatting-with-icon" src="" alt="Friend Icon" class="profile-icon">
        <span id="chatting-with-name" class="friend-username"></span>
    </div>
    <div class="call-buttons">
        <button class="audio-call-btn"><i class="fas fa-phone"></i></button>
        <button class="video-call-btn"><i class="fas fa-video"></i></button>
        <button id="chat-menu-dots">⋮</button>
    </div>
</div>
        <div class="messages" id="messages"></div>
        <div id="upload-progress-container" style="display: none; margin-top: 10px; height: 8px; width: 100%; background: #ddd; border-radius: 5px; overflow: hidden;">
  <div id="upload-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(to right, #00f260, #0575e6); transition: width 0.3s;"></div>
</div>
         <div id="typing-indicator" style="display: none; font-size: 24px; font-style: italic; color: yellow;">User is typing...</div>
        <div class="message-box">
	<label for="attachment-input"><i class="fas fa-paperclip"></i></label>
    <input type="file" id="attachment-input" accept=".jpg,.png,.pdf,.gif" style="display:none;" >
   <input type="text" class="message-input" id="message-input" placeholder="Type your message here">
            
<div style="background: #000;" class="send-btn" id="send-btn"><i style="color: #fff:" class="fas fa-paper-plane"></i></div>
        </div>
        <button id="back-to-search">Back to Search</button>
    </section>
</div>
<div id="imageModal" style="display:none;">
    <div class="modal-content">
        <span id="closeModal">X</span>
        <img id="modalImage" alt="Modal Image">
    </div>
</div>
<div id="fullViewModal" class="modal">
    <div class="modal-content">
        <span id="closeFullViewModal" class="close">&times;</span>
        <div id="modalMediaContent" style="text-align: center;"></div>
    </div>
</div>

<div id="modalOverlay" class="modal-overlay"></div>

<section id="fetchFriends" class="friends-list-section">
    <h2>Friends</h2>
    <div id="FetchFriends">
        <p>Loading friends...</p>
    </div>
</section>

<!-- profile dropdown -->
	
  <div class="dropdown" id="dropdownMenu">
    <div class="dropdown-content">
      <div class="profile-header">
        <img id="dropdown-profile-pic" src="background.jpg" alt="Profile" class="profile-pic">
        <div class="status-dot"></div>
       <span class="dot-container">
        <div class="dot-1" style="border-radius: 50%; width: 15px; height: 15px; background: linear-gradient(90deg, #ff416c, #ccc); position: absolute; left: 95px; bottom: 45px;"></div>
                <div class="dot-2" style="border-radius: 50%; width: 20px; height: 20px; background: linear-gradient(90deg, #ff416c, #ccc); position: absolute; left: 115; bottom: 40px;"></div>
                 <div class="dot-3" style="border-radius: 50%; width: 25px; height: 25px; background: linear-gradient(-90deg, #aaa , #ff416c); position: absolute; left: 135; bottom: 25px;"></div> 
       </span>              
<div class="note-bubble" id="note">
  <span id="note-text-display-bubble">do what you are not capable of doing</span>
  <i id="edit-pencil-bubble" class="fas fa-pencil-alt edit-pencil" onclick="editNote()"></i>
</div>
      </div>

      <div class="profile-body">
        <div class="username" id="dropdown-username">JohnDoe</div>
        <div class="about" id="dropdown-email">#johndoe@ChatWithUs.com</div>

        <button id="Edit-your-profile" class="edit-btn">Edit Profile</button>

        <div class="info-box">
          <div class="label">Member Since <div class="value"> Jul 24, 2023</div></div>
        </div>

        <div class="info-box">
          <div id="FriendsSection" class="label">Your Friends <i class="fas fa-chevron-right"></i></div>
        </div>

   <div class="info-box">
  <div class="label">
    Note:
    <div id="note-container">
      <div id="note-display" style="display: flex; align-items: center; gap: 6px;">
        <span class="note-text-display-info">do what you are not capable of doing</span>
        <i id="edit-pencil-info" class="fas fa-pencil-alt edit-pencil" onclick="editNote()"></i>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
  </div>

  <section id="profile-settings-section">
    <main>
      <img src="avatar.png" alt="Profile Icon" class="profile-settings-profile-icon" id="profileIconInSettings">
      <h2 class="profile-settings-username"></h2>
    </main>
    
    <header class="additional-settings-text">
      <p>ADDITIONAL PERMISSIONS :</p>
    </header>

    <div>
      <h3>Floating Notifications:</h3>
      <p>Show notifications as floating popups on your screen.</p>
    </div>

    <div id="Dark-Mode">
      <h3>Dark Mode:</h3>
      <p>Enable dark mode for a better visual experience in low light.</p>
    </div>

    <div>
      <h3>Profile Privacy:</h3>
      <p>Control who can see your profile (Public, Friends, Only Me).</p>
    </div>

    <div>
      <h3>Password & Security:</h3>
      <p>Manage your password and security settings.</p>
    </div>
    
    <div>
      <h3>Activity Status:</h3>
      <p>Show your online activity status to others.</p>
    </div>

    <div id="Deactivate-Account">
      <h3>Account Deactivation/Delete:</h3>
      <p>Deactivate or permanently delete your account.</p>
    </div>
  </section>
  
  <section id="Deactivate-Account-Section">
  	
 </section>
  
  <section id="Dark-Mode-Section">
  <div class="Dark-Mode-container">
    <div class="Dark-Mode-box">
      <div style="font-size: 30px; margin-bottom: 20px;" class="back-profile-settings"><i class="fas fa-arrow-left" ></i></div>
        <div style="color: #fff; font-size: 28px; margin-bottom: 30px;">Dark Mode Access</div>

      <div class="toggle-row">
        <div style="color: #fff" class="toggle-label">Enable Dark Mode</div>
        <label class="theme-toggle">
          <input type="checkbox" id="theme-switch">
          <span class="slider"></span>
        </label>
      </div>

      <div style="font-size: 14px; color: #fff;">
        Allow this app to enable or disable Dark Mode based on your preference. If granted, the app can manage appearance settings without asking each time.
      </div>
    </div>
        <div style="padding: 10px; justify-content: center; text-align: center;">
    <img style="width: 70%; height: 20%;border-radius: 40px; border: 2px solid white;" src="icon/17O57280R925G27_IMG_9959.jpg">
    	</div>
  </div>
</section>
  
  <!-- edit profile -->
<section id="Edit-profile">
  <header>
    <span class="back-arrow">&#8592;</span>
    <h2>Profile</h2>
    <span class="save-profile-btn">Save</span>
  </header>

<div class="tabs">
  <div class="tab login-history-btn">Login History</div>
    <div class="tab active">Your Profile</div>
  <div id="profile-settings"><i style="font-size: 24px;" class="fas fa-cog"></i></div>
</div>

<div class="profile-banner">
  <div class="avatar-wrapper">
    <img src="avatar.png" alt="Avatar" class="avatar" id="profileIconPreview">
    <div class="edit-icon" onclick="document.getElementById('profileIconInput').click();">
      <i class="fas fa-pencil-alt"></i>
    </div>
    <input type="file" id="profileIconInput" accept="image/*" style="display: none;" onchange="previewProfileIcon(this)">
  </div>
</div>

  <div class="profile-content">
    <div class="real-username"></div>
    
<div class="field">
  <label>Add Email Address for configuration</label>
 <input type="email" id="userEmail" placeholder="Enter your email" value="yourGmail@example.com">
  </div>

    <div class="field">
      <label>About Me</label>
      <input type="text" id="userAbout" placeholder="Tell us about yourself">
    </div>
  </div>
</section>

<!-- Profile Editor Modal -->
<div id="profileEditorModal" class="profileIconmodal">
  <div class="profileIconmodal-content">
    <div class="circle-frame-wrapper" id="imageWrapper" style="position:relative;">
  <div class="circle-frame">
    <img id="selectedImage" src="" alt="Selected Preview">
  </div>
</div>
    <button id="saveProfileImage">Save</button>
  </div>
</div>

<!-- Modal for Login History -->
<div id="loginHistoryModal" class="login-history-modal">
    <div class="history-content">
        <span class="history-close-btn">&times;</span>
        <h2>Login History</h2>
        <ul id="login-history-list"></ul>
    </div>
</div>

<!-- friends Dropdown -->
<div class="friends-info-dropdown" id="dropdown-info">
    <div class="drag-handle" id="dragHandle"></div>
  <div class="profile-card">
            <div class="cover"></div>
            <div class="profile-info">
                	  <img src="" alt="Profile Icon" class="friend-profile-icon">
                <div class="actions">
                  <button style="border: none; background: none; box-shadow: none; margin-top: -60px;" class="remove-friend-btn"><i style="font-size: 40px;" class="fas fa-trash"></i></button>
            <button style="border: none; background: none; box-shadow: none; margin-top: -60px; margin-left: 10px;" class="block-friend-btn" id="block_friend">
              <i class="fas fa-user-slash" style="color: red; font-size: 28px;"></i>
            </button>
          </div>
        </div>
            <div class="profile-details">
                <h2 class="friend-username"></h2>
                <p class="mutual-friend"><i class="fas fa-user"></i> 0 Mutual Friends</p>
               <div class="member-since">Friends since: loading...</div>
            </div>
           <div class="chat-controls">
      <button class="chat-friend-btn"><i class="fas fa-comment-dots"></i></button>
      <button class="video-call-btn"><i class="fas fa-video"></i></button>
      <button class="audio-call-btn"><i class="fas fa-phone"></i></button>
    </div>
    <div class="friend-about" style="margin-top: 250px;">
        <h3>About</h3>
        <p class="friend-about-text">Loading about friend...</p>
    </div>
 </div>
</div>
<!-- blocked Friends -->
<div id="blockedFriendsModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span id="closeBlockedFriendsModal" class="close">&times;</span>
        <h2>Blocked Friends</h2>
        <div id="blockedFriendsList">
            <p>Loading blocked Friends...</p>
        </div>
    </div>
</div>

<!-- Network popup -->
<div id="network-popup">
  <div class="popup-content">
    <h2>Network Issue Detected</h2>
    <p>Network connection is poor or disconnected.<br>
    Please check your internet connection or try again later.</p>
  </div>
</div>

<!-- overlayed loading -->
<div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; 
    width: 100%; height: 100%; background: rgba(0, 0, 0, 1); 
    align-items: center; justify-content: center; z-index: 9999;">
  <div style="border: 6px solid #f3f3f3; border-top: 6px solid #3498db; 
      border-radius: 50%; width: 60px; height: 60px; 
      animation: loadingAnimation 1s linear infinite;">
  </div>
</div>

<script>
    const authSection = document.getElementById('auth-section');
const searchSection = document.getElementById('search-section');
const chatSection = document.getElementById('chat-section');
const messagesDiv = document.getElementById('messages');
const messageInput = document.getElementById('message-input');
const userSearchResult = document.getElementById('user-search-result');

let currentFriendId = null;
let currentFriendUsername = null;
let currentFriendProfileIcon = null;

// Utility: Show specific section
function showSection(sectionId) {
    // First, validate the session (except for auth-section)
    if (sectionId !== 'auth-section' && !isUserLoggedIn()) {
        showSection('auth-section'); // Redirect to Auth section
        return; // Stop execution so the section doesn't show
    }

    // Hide all sections
    authSection.classList.remove('active');
    searchSection.classList.remove('active');
    chatSection.classList.remove('active');
    document.getElementById(sectionId).classList.add('active');

    if (sectionId === 'search-section') {
        fetchNotifications(); // Refresh notifications when in search
    }
}

// Helper function to check if the user is logged in
function isUserLoggedIn() {
    const profileName = document.getElementById("profile-name").textContent.trim();
    const profileEmail = document.getElementById("profile-email").textContent.trim();
    const profilePic = document.getElementById("profile-pic").src;

    return sessionStorage.getItem("user_id") &&
           profileName !== "Loading..." &&
           profileName !== "" &&
           profileEmail !== "#username@ChatWithUs.com" &&
           !profilePic.includes("default-user.png");
}

// Signup Handler
// Signup Handler
document.getElementById('signup-btn').addEventListener('click', function (event) {
    event.preventDefault(); // Prevent form submission
    const formData = new FormData();
    const username = document.getElementById('signup-username').value;
    const password = document.getElementById('signup-password').value;
    const profileIcon = document.getElementById('profile-icon').files[0];
    
    if (!isValidUsername(username)) {
        alert("Username must be 3-12 characters, contain no spaces, and only letters/numbers.");
        return;
    }

    if (password.length < 6) {
        alert("Password must be at least 6 characters long.");
        return;
    }
    
    formData.append('action', 'signup');
    formData.append('username', username);
    formData.append('password', password);
    formData.append('profile_icon', profileIcon);

    fetch('backend.php', { method: 'POST', body: formData })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                // Store data in localStorage

                alert('Signedup successfully, Please login!!');
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
});

document.addEventListener('DOMContentLoaded', function () {
    // Check if user is already logged in
    const userId = sessionStorage.getItem('user_id');
    const username = sessionStorage.getItem('username');
    const profileIcon = sessionStorage.getItem('profile_icon');

    if (userId && username && profileIcon) {
        // User is already logged in, show their profile and search section
        document.getElementById("profile-name").textContent = username;
        document.getElementById("profile-email").textContent = `#${username}@ChatWithUs.com`;
        document.getElementById("profile-pic").src = profileIcon || "default-user.png";

        // Hide login section and show search section
        document.getElementById('auth-section').classList.remove('active');
        showSection('search-section');
    } else {
        // User is not logged in, show login/signup section
        document.getElementById('auth-section').classList.add('active');
        showSection('login-section'); // Show login/signup form
    }
});

// Login Handler
document.getElementById('login-btn').addEventListener('click', function (event) {
    event.preventDefault(); // Prevent form submission
    const payload = {
        action: 'login',
        username: document.getElementById('login-username').value,
        password: document.getElementById('login-password').value,
    };
    
    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
    })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                sessionStorage.setItem('user_id', data.user_id);
                sessionStorage.setItem('username', data.username);
                sessionStorage.setItem('profile_icon', data.profile_icon);
                
                // Hide auth section and show the search section
                authSection.classList.remove('active');
                document.getElementById("profile-name").textContent = data.username;
            document.getElementById("profile-email").textContent = `#${data.username}@ChatWithUs.com`;
            document.getElementById("profile-pic").src = data.profile_icon || "default-user.png";
                showSection('search-section');
            } else {
                alert(data.message);
            }
        });
});
function isValidUsername(username) {
    return /^[a-zA-Z0-9]{3,12}$/.test(username); // No spaces, only letters & numbers, 3-12 chars
}
// Search Friends Handler
document.getElementById('search-btn').addEventListener('click', function () {
    handleSearch();
});

document.getElementById('search-user').addEventListener('keypress', function (event) {
    if (event.key === 'Enter') {
        event.preventDefault(); // Prevent default form submission
        handleSearch();
    }
});

function handleSearch() {
    const username = document.getElementById('search-user').value.trim();
    const userId = sessionStorage.getItem('user_id');

    if (!userId) {
        alert('You must log in to search for friends.');
        showSection('auth-section');
        return;
    }

    if (!username) {
        alert('Please enter a username to search.');
        return;
    }

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'search', username }),
    })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            userSearchResult.innerHTML = `
                <div>
                    <img src="${data.profile_icon || 'default-icon.png'}" alt="Profile" style="width: 50px; height: 50px; border-radius: 50%;">
                    <span>${data.username}</span>
                    <p id="user-status-${data.id}" class="user-status">Checking...</p>
                    <button class="send-request" data-userid="${data.id}">Send Request</button>
                    <button onclick="startChat(${data.id})">Chat</button>
                </div>
            `;

            //  Ensure `fetchUserStatus()` is called after the user is added to the DOM
            setTimeout(() => fetchUserStatus(data.id), 100);
        } else {
            userSearchResult.innerHTML = '<p>User not found</p>';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to fetch user information. Please try again.');
    });
}

// Fetch Notifications
function fetchNotifications() {
    const userId = sessionStorage.getItem('user_id');
    if (!userId) return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch_notifications', user_id: userId }),
    })
    .then(res => res.json())
    .then(data => {
        const notificationsList = document.getElementById('notifications-list');
        notificationsList.innerHTML = ''; // Clear old notifications

        if (data.success && data.notifications.length > 0) {
            const uniqueUsers = new Set(); //  Track unique users

            data.notifications.forEach(notification => {
                if (!uniqueUsers.has(notification.sender_id)) { //  Prevent duplicate usernames
                    uniqueUsers.add(notification.sender_id);

                    //  Check if user already exists in the DOM
                    if (!document.getElementById(`notification-${notification.sender_id}`)) {
                        let notificationElement = document.createElement("div");
                        notificationElement.classList.add("notification-item");
                        notificationElement.id = `notification-${notification.sender_id}`; //  Unique ID per user
                        notificationElement.innerHTML = `
                            <div>
                                <img src="${notification.profile_icon}" alt="Profile" style="width: 50px; height: 50px; border-radius: 50%;">
                                <span>${notification.username}</span>
                                <p id="user-status-${notification.sender_id}" style="font-size: 12px; color: gray;">Checking status...</p>
                                <button style="width: 100px;" onclick="startChat(${notification.sender_id})">Chat</button>
                            </div>
                        `;

                        notificationsList.appendChild(notificationElement);
                        //  Restore last known status before calling `fetchUserStatus`
                        
                        fetchUserStatus(notification.sender_id);
                    }
                }
            });
        } else {
            notificationsList.innerHTML = '<p>No new notifications</p>';
        }
    })
    .catch(error => console.error(' Error fetching notifications:', error));
}


// Start Chat Handler
function startChat(friendId) {
    currentFriendId = friendId;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'mark_notifications_read', user_id: sessionStorage.getItem('user_id'), friend_id: currentFriendId }),
    });
document.getElementById("friendsListSection")?.classList.remove("active");
    
    document.getElementById("search-section")?.classList.remove("active");
    document.getElementById("public-group-section")?.classList.remove("active");
    document.getElementById("manageGroupBox")?.classList.remove("active");
    document.getElementById("friend-requests-section")?.classList.remove("active");

    // Show only the Chat Section
    document.getElementById("chat-section")?.classList.add("active");
    fetchMessages(); // Fetch initial messages
}
function escapeHTML(str) {
    if (!str) return '';
    return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}
function escapeJSString(str) {
    if (!str) return '';
    return str
        .replace(/\\/g, '\\\\')   // escape backslashes
        .replace(/'/g, "\\'")     // escape single quotes
        .replace(/"/g, '\\"')     // escape double quotes
        .replace(/\n/g, '\\n')    // escape newlines
        .replace(/\r/g, '\\r');   // escape carriage returns
}

// Fetch Messages
function fetchMessages() {
	
      const messagesDiv = document.getElementById('messages');
      
if (document.querySelector('.message-menu[style="display: block;"]')) {
        return;
    }

    const userId = sessionStorage.getItem('user_id');
    const friendId = currentFriendId;
const currentScrollPosition = messagesDiv.scrollTop;
    const isScrolledToBottom = (messagesDiv.scrollHeight - messagesDiv.clientHeight) === currentScrollPosition;
    
    if (!userId || !friendId) {
        console.error("User ID or Friend ID is missing.");
        return;
    }



    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            action: 'fetch_messages',
            user_id: userId,
            friend_id: friendId
        }),
    })
    .then(response => response.json())
    .then(data => {
        
        if (data.success) {
        	const friendIcon = data.friend?.profile_icon || 'default-icon.png';
const friendName = data.friend?.username || 'Unknown User';

document.getElementById('chatting-with-icon').src = friendIcon;
document.getElementById('chatting-with-name').textContent = friendName;

            const playingMedia = Array.from(messagesDiv.querySelectorAll('video, audio')).reduce((acc, el) => {
                if (!el.paused) acc[el.id] = el.currentTime;
                return acc;
            }, {});

            messagesDiv.innerHTML = '';

           let hasUnreadMessages = false;

            data.messages.forEach(msg => {
                const isSentByUser = msg.sender_id == userId;                
                const senderProfileIcon = isSentByUser ? data.currentUser.profile_icon : data.friend.profile_icon;
                const senderUsername = isSentByUser ? data.currentUser.username : data.friend.username;
                               

                // Create message container
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', isSentByUser ? 'sent' : 'received');

                // Build message content
                let content = `
    <img src="${senderProfileIcon || 'default-icon.png'}" alt="Profile" class="profile-icon">
    <div>
        <div class="username">${senderUsername}</div>
        <div class="content">${escapeHTML(msg.message)}</div>
       <div style="font-size: 12px; color: #00FF99; margin-top: 2px;">${msg.formatted_time || ''}</div>       
        ${isSentByUser ? `
            <div class="message-options">
                <i class="fas fa-ellipsis-h" onclick="toggleMessageMenu(this)"></i>
                <div class="message-menu">
                    <button onclick="editMessage(this, '${msg.id}', '${escapeJSString(msg.message)}')">Edit</button>
                    <button onclick="deleteMessage('${msg.id}', this)">Delete</button>
                </div>
            </div>
        ` : ''}
    </div>
`;

                // Handle attachments
                      if (msg.attachment) {
                    if (msg.attachment.match(/\.(jpg|png|gif)$/)) {
    content += `
        <img src="${msg.attachment}" alt="Attachment" class="attachment-image" 
            onclick="showImageModal('${msg.attachment}')" style="cursor:pointer;">
    `;

                    } else if (msg.attachment.match(/\.(mp4)$/)) {
                        // Video attachment
                        content += `
                            <div>
                                <video controls class="attachment-video" id="video-${msg.id}" style="width: 100%; max-width: 500px;">
                                    <source src="${msg.attachment}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                                <button class="full-view-btn" data-src="${msg.attachment}" data-type="video">Full View</button>
                            </div>`;
                    } else if (msg.attachment.match(/\.(mp3)$/)) {
                        content += `
                            <div>
                                <audio controls class="attachment-audio" id="audio-${msg.id}" style="width: 100%;">
                                    <source src="${msg.attachment}" type="audio/mp3">
                                     Your browser does not support the audio element.
                                </audio>
                                <button class="full-view-btn" data-src="${msg.attachment}" data-type="audio">Full View</button>
                            </div>`;
                    } else {
                        // Unsupported attachment
                        content += `<a href="${msg.attachment}" target="_blank" class="attachment-link">Download File</a>`;
                    }
                }

                content += `</div>`; // Close inner div
                messageDiv.innerHTML = content;
                messagesDiv.appendChild(messageDiv);

            });
setTimeout(() => {
if (isScrolledToBottom) {
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            } else {
                // If the user wasn't at the bottom, retain the scroll position
                messagesDiv.scrollTop = currentScrollPosition;
            }
    // Restore media playback
    Object.keys(playingMedia).forEach(id => {
        const media = document.getElementById(id);
        if (media) {
            media.currentTime = playingMedia[id];
            media.play(); // Resume playback
        }
    });
}, 100);
        } else {
            document.getElementById('messages').innerHTML = `<div class="error-message">${data.message}</div>`;
        }
    })
    .catch(error => {
        console.error('Error fetching messages:', error);
    });
}

// Function to show image in a modal
function showImageModal(imageSrc) {
    const modal = document.createElement('div');
    modal.classList.add('modal');
    modal.innerHTML = `
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <img src="${imageSrc}" alt="Modal Image" class="modal-image">
        </div>
    `;
    document.body.appendChild(modal);

    const closeButton = modal.querySelector('.close-button');
    closeButton.addEventListener('click', () => {
        document.body.removeChild(modal);
    });

    // Close modal when clicking outside of the image
    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

// Function to handle full view of attachments (video/audio)
// Send Messages
// Send Messages Handler
document.getElementById('send-btn').addEventListener('click', function () {
    sendMessage();
});

// Handle pressing Enter in the Message Input Box
document.getElementById('message-input').addEventListener('keypress', function (event) {
    if (event.key === 'Enter') {
        event.preventDefault(); // Prevent default action
        sendMessage(); // Trigger send message function
    }
});

let isCooldown = false;

function sendMessage() {
    if (isCooldown) {
        alert('Please wait 3 seconds before sending another message.');
        return; // Exit if the cooldown is active
    }

    const userId = sessionStorage.getItem('user_id'); // Get sender user ID
    const receiverId = currentFriendId; // Get receiver ID (should be set when starting chat)
    const message = document.getElementById('message-input').value.trim(); // Get message text
    const attachment = document.getElementById('attachment-input').files[0]; // Get selected file

    if (!userId || !receiverId) {
        alert('You must select a friend to chat with.');
        return; // Exit if no friend is selected
    }

    if (!message && !attachment) {
        alert('Empty message cannot be sent!');
        return;
    }

    if (!message && attachment) {
        alert('You must enter a message along with the attachment.');
        return;
    }

    // Create FormData object to handle both text and file data
    const formData = new FormData();
    formData.append('action', 'send_message'); // Action type
    formData.append('sender_id', userId); // Sender ID
    formData.append('receiver_id', receiverId); // Receiver ID
    if (message) formData.append('message', message); // Add message text if provided
    if (attachment) formData.append('attachment', attachment); // Add file if provided

    // Show progress bar
    const progressContainer = document.getElementById('upload-progress-container');
    const progressBar = document.getElementById('upload-progress-bar');
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';

    // Simulated progress (since fetch doesn't support upload progress natively)
    let fakeProgress = 0;
    const simulateProgress = setInterval(() => {
    if (fakeProgress >= 45) {
        clearInterval(simulateProgress); // Stop simulating after 45%
        return;
    }
    fakeProgress += 1;
    progressBar.style.width = fakeProgress + '%';
}, 100);

    // Make a POST request to the server
    fetch('backend.php', {
        method: 'POST',
        body: formData, // FormData for file and message
    })
    .then(response => response.json())
    .then(data => {
        clearInterval(simulateProgress);
        progressBar.style.width = '100%';
        setTimeout(() => {
            progressContainer.style.display = 'none';
            progressBar.style.width = '0%';
        }, 300);

        if (data.success) {
            // On success, reload messages and clear input fields
            fetchMessages(); // Refresh message list
            const messageInput = document.getElementById('message-input');
            const attachmentInput = document.getElementById('attachment-input');
            messageInput.value = '';
            attachmentInput.value = '';
            isCooldown = true;
            setTimeout(() => {
                isCooldown = false; // Reset cooldown after 3 seconds
            }, 3000);
        } else {
            // Display error if the server response indicates failure
            alert(data.message || 'Failed to send message.');
        }
    })
    .catch(error => {
        clearInterval(simulateProgress);
        progressContainer.style.display = 'none';
        progressBar.style.transition = 'width 0.3s ease';       
        progressBar.style.width = '0%';      

        console.error('Error sending message:', error);
        alert('An error occurred while sending the message. Please try again.');
    });
}


// Back to Search
document.getElementById('back-to-search').addEventListener('click', function () {
    showSection('search-section');
    document.getElementById('friendsListSection').classList.remove('active');
});

// Get modal elements
const container = document.getElementById("container");
    const registerBtn = document.getElementById("register");
    const loginBtn = document.getElementById("login");

    registerBtn.addEventListener("click", () => {
      container.classList.add("active");
    });

    loginBtn.addEventListener("click", () => {
      container.classList.remove("active");
    });
document.getElementById("logout-btn").addEventListener("click", function() {
    const logoutButton = this;

    // Prevent button from moving
    logoutButton.style.position = "absolute";

    // Apply animation
    logoutButton.style.animation = "logoutFade 0.5s forwards";

    setTimeout(() => {
        // Clear session data
        sessionStorage.removeItem('user_id');
        sessionStorage.removeItem('username');
        sessionStorage.removeItem('profile_icon');

        // Show logout message
        alert("You have been logged out!");

        // Reload the page to return to the login screen
        window.location.reload();
    }, 500);
});


let typingTimeout;

messageInput.addEventListener('input', () => {
    clearTimeout(typingTimeout);
    sendTypingStatus(true); // Notify the backend that the user is typing

    typingTimeout = setTimeout(() => {
        sendTypingStatus(false); // Notify the backend that the user stopped typing
    }, 1000); // Delay to mark the end of typing
});

function sendTypingStatus(isTyping) {
    const userId = sessionStorage.getItem('user_id');
    if (!userId || !currentFriendId) return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            action: 'typing_status',
            sender_id: userId,
            receiver_id: currentFriendId,
            is_typing: isTyping
        }),
    });
}

// Listen for typing notifications from the backend
let messageInterval, typingInterval;

function startChat(friendId) {
    currentFriendId = friendId;

    if (messageInterval) clearInterval(messageInterval);
    if (typingInterval) clearInterval(typingInterval);

    showSection('chat-section');
    fetchMessages();

    messageInterval = setInterval(fetchMessages, 3000);
    typingInterval = setInterval(() => {
        fetch('backend.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: 'get_typing_status',
                user_id: sessionStorage.getItem('user_id'),
                friend_id: currentFriendId
            }),
        })
        .then(response => response.json())
        .then(data => {
            const typingIndicator = document.getElementById('typing-indicator');
            if (data.success && data.is_typing && data.username) {
                typingIndicator.style.display = 'block';
                typingIndicator.textContent = `${data.username} is typing...`;
            } else {
                typingIndicator.style.display = 'none';
            }
        });
    }, 1000);
}
// Show image in modal
function showImageModal(imageSrc) {
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    modalImage.src = imageSrc;
    modal.style.display = 'flex';

    // Close modal when the close button is clicked
    document.getElementById('closeModal').onclick = () => {
        modal.style.display = 'none';
        modalImage.src = '';
    };

    // Close modal when clicking outside the modal content
    window.onclick = (event) => {
        if (event.target === modal) {
            modal.style.display = 'none';
            modalImage.src = '';
        }
    };
}
// Add event listener for all Full View buttons dynamically
document.addEventListener('click', function (event) {
    if (event.target.classList.contains('full-view-btn')) {
        const src = event.target.getAttribute('data-src');
        const type = event.target.getAttribute('data-type');
        const modalContent = document.getElementById('modalMediaContent');

        // Clear existing modal content
        modalContent.innerHTML = '';

        // Add video or audio based on type
        if (type === 'video') {
            modalContent.innerHTML = `
                <video controls style="width: 100%; max-width: 500px;">
                    <source src="${src}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>`;
        } else if (type === 'audio') {
            modalContent.innerHTML = `
                <audio controls style="width: 100%; max-width: 500px;">
                    <source src="${src}" type="audio/mp3">
                    Your browser does not support the audio element.
                </audio>`;
        }

        // Show modal
        document.getElementById('fullViewModal').style.display = 'flex';
    }
});

// Close Full View Modal
document.getElementById('closeFullViewModal').addEventListener('click', function () {
    document.getElementById('fullViewModal').style.display = 'none';
});

// Close Modal When Clicking Outside
window.addEventListener('click', function (event) {
    const modal = document.getElementById('fullViewModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});

function togglePassword(fieldId, toggleIcon) {
    const passwordField = document.getElementById(fieldId);
    const isPassword = passwordField.type === "password";
    passwordField.type = isPassword ? "text" : "password";
    toggleIcon.classList.toggle("fa-eye");
    toggleIcon.classList.toggle("fa-eye-slash");
}
// Get modal elements
// Get modal elements
const createGroupModal = document.getElementById("createGroupModal");
const createGroupBtn = document.getElementById("createGroupBtn");
const closeCreateGroupModal = createGroupModal.querySelector(".closeModal");
const createGroupSubmit = document.getElementById("createGroupSubmit");

// Open Create Group Modal
createGroupBtn.addEventListener("click", () => {
    createGroupModal.style.display = "flex";
});

// Close Create Group Modal
closeCreateGroupModal.addEventListener("click", () => {
    createGroupModal.style.display = "none";
});

// Close modal when clicking outside the modal content
window.addEventListener("click", (event) => {
    if (event.target === createGroupModal) {
        createGroupModal.style.display = "none";
    }
});

createGroupSubmit.addEventListener("click", () => {
    const formData = new FormData();
    const groupName = document.getElementById("group-name").value;
    const groupIcon = document.getElementById("group-icon").files[0];
    const groupDescription = document.getElementById("group-description").value;
    const groupPrivacy = document.getElementById("group-privacy").value;

    // Get user_id from sessionStorage
    const userId = sessionStorage.getItem("user_id");

    // Validate inputs
    if (!groupName) {
        alert("Please enter a group name.");
        return;
    }

    formData.append("action", "create_group");
    formData.append("group_name", groupName);
    formData.append("group_icon", groupIcon);
    formData.append("group_description", groupDescription);
    formData.append("group_privacy", groupPrivacy);
    formData.append("user_id", userId); // Send user_id to the backend

    // Make backend call to create the group
    fetch("backend.php", {
        method: "POST",
        body: formData,
    })
        .then((response) => response.json())
        .then((data) => {
    console.log('Group creation response:', data); // Add this line to debug
    if (data.success) {
        alert("Group created successfully!");
        createGroupModal.style.display = "none";
        fetchPublicGroups();
    } else {
        alert(data.message || "Failed to create group.");
    }
})
        .catch((error) => {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
        });
});
// Function to fetch public groups and update the UI
// Fetch and display public groups
function fetchPublicGroups() {
    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch_public_groups' }),
    })
    .then(response => response.json())
    .then(data => {
        const groupList = document.getElementById('groupList');
        groupList.innerHTML = ''; // Clear the existing list
        
        if (data.success && data.groups.length > 0) {
            data.groups.forEach(group => {
            	const groupId = group.group_id;
                const groupName = group.group_name || 'Unnamed Group';
                const groupIcon = group.group_icon || 'default-group-icon.png';
                const groupDescription = group.group_description || 'No description available';
                const creatorUsername = group.creator_username || 'Unknown';
                const creatorIcon = group.creator_icon || 'default-user-icon.png';
               const likes = group.likes || 0;
                const userLiked = group.user_liked > 0; // âœ… Check if user has liked it
                // Add group to the list
                groupList.innerHTML += `
                    <div class="group-item">
                        <img src="${groupIcon}" alt="Group Icon" width="50">
                        <div>
                            <h4>Group name => "${groupName}"</h4>
                            <p>Group description => "${groupDescription}"</p>
                            <H1>Created by:
                                <img src="${creatorIcon}" alt="Creator Icon" width="30">
                                ${creatorUsername}
                            </H1>
                        </div>
<div style="display: flex; justify-content: space-between; width: 100%; padding: 0px;">
    <button style="width: 120px; height: 50px; font-size: 18px; color: white; border: none; border-radius: 8px; cursor: pointer;"  class="heart-btn ${userLiked ? 'liked' : ''}" data-group-id="${groupId}" onclick="likeGroup(${groupId})">
                            <i class="fa-solid fa-heart"></i> <span id="like-count-${groupId}">${likes}</span>
                        </button>
<button style="width: 120px; height: 50px; font-size: 18px; color: white; border: none; border-radius: 8px; cursor: pointer;">JOIN</button>
</div>
                    </div>
                    
                `;
            });
            setTimeout(() => {
                const searchInput = document.getElementById("search-public-group");
                const groups = document.querySelectorAll(".group-item");

                if (searchInput && groups.length > 0) {
                    searchInput.addEventListener("input", function () {
                        let searchQuery = this.value.toLowerCase();
                        groups.forEach(group => {
                            let groupNameElement = group.querySelector(".group-name");
                            if (groupNameElement) {
                                let groupName = groupNameElement.textContent.toLowerCase();
                                group.style.display = groupName.includes(searchQuery) ? "block" : "none";
                            }
                        });
                    });
                }
            }, 100);
        } else {
            groupList.innerHTML = '<p>No public groups found.</p>';
        }
    })
    .catch(error => {
        console.error('Error fetching public groups:', error);
        alert('Failed to load groups. Please try again.');
    });
}
fetchPublicGroups();

function fetchUserGroups() {
    const userId = sessionStorage.getItem('user_id');
    

    // Predefined unique colors
    const uniqueColors = [
        '#FFDDC1', '#FFABAB', '#FFC3A0', '#D5AAFF',
        '#85E3FF', '#B9FBC0', '#FBFFA3', '#FFABAB',
        '#FFC3A0', '#D5AAFF', '#85E3FF'
    ];

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch_user_groups', user_id: userId }),
    })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const groupList = document.getElementById('yourGroupList');
            if (!groupList) {
                console.error('Error: Element with ID "yourGroupList" does not exist.');
                return;
            }

            groupList.innerHTML = ''; // Clear any existing groups

            if (data.success && data.groups.length > 0) {
                data.groups.forEach((group, index) => { // Use index from forEach
                    const groupName = group.name || 'Unnamed Group';
                    const groupIcon = group.icon || 'default-group-icon.png';
                    const groupDescription = group.description || 'No description available';
                    const privacy = group.privacy ? group.privacy.charAt(0).toUpperCase() + group.privacy.slice(1) : 'Unknown';
                    const backgroundColor = uniqueColors[index % uniqueColors.length]; // Cycle through colors
                  
                    groupList.innerHTML += `
                        <div class="group-item" style="background-color: ${backgroundColor};">
                            <img src="${groupIcon}" alt="Group Icon" width="50">
                            <div>
                                <h4>Group Name: ${groupName}</h4>
                                <p>Description: ${groupDescription}</p>
                                <p>Privacy: ${privacy}</p>
                               
<button class="manage-group-btn" data-group-id="${group.id}" data-group-name="${group.name}">Manage <i class="fas fa-wrench"></i></button>
                        </div>
                            </div>
                    `;
                });
            } else {
                groupList.innerHTML = '<p>No groups found. Create a group to see it here!</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching user groups:', error);
            
        });
}

fetchUserGroups();
	setInterval(fetchUserGroups, 1000);
// Add event listener for Join buttons
document.body.addEventListener('click', function (event) {
    if (event.target.tagName === 'BUTTON' && event.target.textContent.trim().toUpperCase() === 'JOIN') {
        const groupItem = event.target.closest('.group-item');
        const groupNameElement = groupItem.querySelector('h4');
        if (!groupNameElement) return;

        const groupNameRaw = groupNameElement.textContent;
        const groupName = groupNameRaw.includes('=>') 
            ? groupNameRaw.split('=> ')[1].replace(/"/g, '').trim() 
            : groupNameRaw.split(': ')[1].trim(); // For both Public & Manage

        const userId = sessionStorage.getItem('user_id');
        if (!userId) {
            alert('You must log in to join a group.');
            return;
        }

        fetch('backend.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ action: 'join_group', user_id: userId, group_name: groupName }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            } else {
                alert(data.message || 'Failed to join the group.');
            }
        })
        .catch(error => {
            console.error('Error joining group:', error);
            alert('An error occurred. Please try again.');
        });
    }
});

function fetchJoinedGroups() {
    const userId = sessionStorage.getItem('user_id');

    if (!userId) {
        console.log("Please log in first.");
        return; // Exit early if the user is not logged in
    }

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch_joined_groups', user_id: userId }),
    })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.groups.length > 0) {
                const joinedGroupsList = document.getElementById('joinedGroupsList');
                joinedGroupsList.innerHTML = ''; // Clear previous content

                data.groups.forEach(group => {
                    // Escape and sanitize dynamic values
                    const groupId = group.group_id || 0;
                    const groupName = (group.group_name || "Unnamed Group").replace(/'/g, "\\'");
                    const groupIcon = (group.group_icon || "default-group-icon.png").replace(/'/g, "\\'");
                    const groupDescription = (group.group_description || "No description available").replace(/'/g, "\\'");
                    const groupPrivacy = group.group_privacy || "Unknown";
                    const creatorUsername = group.creator_username || "Unknown Creator";
                    const creatorProfileIcon = group.creator_profile_icon || "default-user-icon.png";

                    // Append group item to the list
                    const groupItem = document.createElement('div');
                groupItem.classList.add('group-item');
                groupItem.innerHTML = `
<div class="group-item" style="display: flex; align-items: center; justify-content: flex-start; padding: 30px; width: 90%; margin: 0 auto 16px auto; border-radius: 20px; background: linear-gradient(135deg, #f5b1d8, #b3e5fc);" onclick="startGroupChat(${groupId}, '${groupName}', '${groupIcon}', '${groupDescription}')">
  <img src="${groupIcon}" alt="Group Icon" width="80" height="80" style="border-radius: 50%;">

  <div style="margin-left: 16px; display: flex; flex-direction: column; justify-content: center;">
    <span style="font-size: 26px; font-weight: bold; color: #333;">${groupName}</span>

  </div>
</div>

                    `;

   joinedGroupsList.appendChild(groupItem);
            });

            // Debugging: Ensure buttons are detected
            document.querySelectorAll('.leave-group-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const groupId = this.getAttribute('data-group-id');
                    leaveGroup(groupId);
                });
            });
            } else {
                

                const joinedGroupsList = document.getElementById('joinedGroupsList');
                joinedGroupsList.innerHTML = '<p>No joined groups found.</p>';
            }
        })
        .catch(error => console.error("Error fetching joined groups:", error));
}

// Call fetchJoinedGroups on page load and 
// Call fetchJoinedGroups on page load
document.addEventListener('DOMContentLoaded', () => {
    fetchJoinedGroups();
});
setInterval(fetchJoinedGroups, 1000);
// Start Group Chat Handler
// Current group variables

// Call fetchJoinedGroups on page load and 
// Call fetchJoinedGroups on page load
document.addEventListener('DOMContentLoaded', () => {
    fetchJoinedGroups();
});
setInterval(fetchJoinedGroups, 1000);
// Start Group Chat Handler
// Current group variables
let currentGroupId = null;

// Start Group Chat
function startGroupChat(groupId, groupName, groupIcon, groupDescription) {
    // Show the full-screen loading overlay (this covers the whole page)
    document.getElementById('loadingOverlay').style.display = 'flex';

    // Immediately show the group chat section
    document.getElementById('chat-section').classList.remove('active');
    document.getElementById('search-section').classList.remove('active');
    document.getElementById('chat-group-section').classList.add('active');

    // Update current group ID
    currentGroupId = groupId;

    // Update group details dynamically
    const groupNameElement = document.getElementById('groupName');
    const groupIconElement = document.getElementById('groupIcon');

    if (groupNameElement) groupNameElement.textContent = groupName || 'Unnamed Group';
    if (groupIconElement) groupIconElement.src = groupIcon || 'default-group-icon.png';

    // Fetch and display group messages
    fetchGroupMessages();

    // Start real-time message fetching
    if (window.groupMessageInterval) clearInterval(window.groupMessageInterval);
    window.groupMessageInterval = setInterval(fetchGroupMessages, 1000);

    // Hide the full-screen loading overlay after 2 seconds
    setTimeout(() => {
        document.getElementById('loadingOverlay').style.display = 'none';
    }, 2000); // 2 seconds delay before hiding the overlay
}

// Fetch Group Messages
function fetchGroupMessages() {
	
		if (document.querySelector('.message-menu[style="display: block;"]')) {
        return;
    }
	
	const userId = sessionStorage.getItem('user_id');
    if (!currentGroupId) {
        console.error('No group ID specified.');
        return;
    }
    
const currentScrollPosition = messagesDiv.scrollTop;
    const isScrolledToBottom = messagesDiv.scrollHeight - messagesDiv.clientHeight <= currentScrollPosition + 10;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch_group_messages', group_id: currentGroupId, user_id: sessionStorage.getItem('user_id') }),
    })
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                const messagesDiv = document.getElementById('groupmessages');
                messagesDiv.innerHTML = ''; // Clear existing messages

                data.messages.forEach((msg) => {
                	const isSentByUser = msg.sender_id == userId;
                    const isAdmin = msg.sender_id == msg.created_by;
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message', isSentByUser ? 'sent' : 'received');

                    messageDiv.innerHTML = `
                        <div style="display: flex; align-items: center;">
                               <img src="${msg.sender_icon || 'default-user-icon.png'}" alt="Profile" class="profile-icon" >
                            <div>
                                   <strong class="username">${msg.sender_id == msg.created_by ? '[ADMIN] ': ''}${msg.sender_username || 'Unknown'}:</strong>
                                <div class="content">${escapeHTML(msg.message)}</div>
                            </div>
                        </div>
                    ${isSentByUser ? `
            <div class="message-options">
                <i class="fas fa-ellipsis-h" onclick="toggleMessageMenu(this)"></i>
                <div class="message-menu">
                    <button onclick="editGroupMessage(this, '${msg.id}', '${escapeJSString(msg.message)}')">Edit</button>
                    <button onclick="deleteGroupMessage('${msg.id}', this)">Delete</button>
                </div>
            </div>
        ` : ''}
    </div>
`;
                    messagesDiv.appendChild(messageDiv);
                });

                // Scroll to the bottom of the messages
                if (!isScrolledToBottom) {
                messagesDiv.scrollTop = currentScrollPosition;
            }
            } else {
                console.error(data.message);
            }
        })
        .catch((error) => console.error('Error fetching group messages:', error));
}

// Send Group Message
function sendGroupMessage() {
if (isCooldown) {
            alert('Please wait 3 seconds before sending another message.');
            return; // Exit if the cooldown is active
        }
    const userId = sessionStorage.getItem('user_id');
    const messageInput = document.getElementById('group-message-input');
    const message = messageInput.value.trim();

    if (!currentGroupId || !userId) {
        alert('Please select a group and enter a message.');
        return;
    }
     if (!message) {
        alert('Empty messages cannot be sent!');
        return;
    }

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            action: 'send_group_message',
            group_id: currentGroupId,
            user_id: userId,
            message: message,
        }),
    })
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                fetchGroupMessages(); // Refresh messages
                messageInput.value = ''; // Clear input
isCooldown = true;
                    setTimeout(() => {
                        isCooldown = false; // Reset cooldown after 3 seconds
                    }, 3000);
            } else {
                alert(data.message || 'Failed to send message.');
            }
        })
        .catch((error) => console.error('Error sending group message:', error));
}

// Hook send button to group message sending
document.getElementById('group-send-btn').addEventListener('click', sendGroupMessage);

// Back Button Functionality
// Constants for attachment limits
const ATTACHMENT_LIMIT = 3;
const MAX_ATTACHMENT_SIZE_MB = 10;
const LIMIT_RESET_HOURS = 24;
const storageKey = 'attachmentTracker';

// Function to initialize the attachment tracker
function initializeAttachmentTracker() {
    const tracker = JSON.parse(localStorage.getItem(storageKey)) || { count: 0, lastReset: Date.now() };

    // Reset if 24 hours have passed
    const hoursPassed = (Date.now() - tracker.lastReset) / (1000 * 60 * 60);
    if (hoursPassed >= LIMIT_RESET_HOURS) {
        tracker.count = 0; // Reset the attachment count
        tracker.lastReset = Date.now(); // Update the reset time
    }

    localStorage.setItem(storageKey, JSON.stringify(tracker));
}

// Function to handle attachment validation
function handleAttachment(event) {
    const tracker = JSON.parse(localStorage.getItem(storageKey));
    const file = event.target.files[0];

    if (tracker.count >= ATTACHMENT_LIMIT) {
        alert('You have reached your attachment limit for the day. Please wait 24 hours to send more attachments.');
        event.target.value = ''; // Clear the input
        return;
    }

    if (file.size / 1024 / 1024 > MAX_ATTACHMENT_SIZE_MB) {
        alert('File size exceeds 10MB. Please select a smaller file.');
        event.target.value = ''; // Clear the input
        return;
    }

    // Increment the attachment count
    tracker.count += 1;
    localStorage.setItem(storageKey, JSON.stringify(tracker));

    alert(`Attachment accepted! You have ${ATTACHMENT_LIMIT - tracker.count} attachment(s) remaining for the day.`);
}

// Initialize the tracker on page load
document.addEventListener('DOMContentLoaded', initializeAttachmentTracker);

// Hook the attachment input to the handler
const attachmentInput = document.getElementById('attachment-input');
attachmentInput.addEventListener('change', handleAttachment);

// Event Listener for the "Manage" Button in the Group List
// Event Listener for the "Manage" Button in the Group List
// Event Listener for the "Manage" Button
document.getElementById('yourGroupList').addEventListener('click', function (event) {
    if (event.target.classList.contains('manage-group-btn')) {
        // Get the closest group-item container
        const groupItem = event.target.closest('.group-item');

        if (!groupItem) {
            console.error('Error: Group item not found.');
            return;
        }

        // Dynamically fetch group_id and group_name from the button attributes
        const groupId = event.target.getAttribute('data-group-id');
        const groupName = event.target.getAttribute('data-group-name');


        if (!groupId) {
            console.error('Error: Group ID is missing.');
            alert('Group ID is missing. Please refresh the page and try again.');
            return;
        }

        // Hide other sections and display the manage group box
        document.getElementById('search-section').classList.remove('active');
        document.getElementById('chat-section').classList.remove('active');
        document.getElementById('manageGroupBox').classList.add('active');
        document.getElementById('yourGroups').classList.remove('active');

        // Update group name in the manage section
        document.getElementById('manageGroupName').textContent = `${groupName || 'Unknown'}`;

        // Fetch and display group details
        fetchGroupDetails(groupId);
    }
});

// Function to Fetch Group Details
function fetchGroupDetails(groupId) {
	const userId = sessionStorage.getItem("user_id"); //  Get user ID
	
    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'fetch_group_users', group_id: groupId, user_id: userId}),
    })
        .then(response => response.text())
        .then(rawData => {
            

            try {
                const data = JSON.parse(rawData);
                if (data.success) {
                    // Display creator's username
                    document.getElementById('manageGroupCreator').textContent = `${data.creator.username}`;
let groupActions = document.querySelector('.group-actions');
                    if (!groupActions) {
                        groupActions = document.createElement('div');
                        groupActions.classList.add('group-actions');
                        groupActions.innerHTML = `
                            
                            <button style="height: 70px; width: 100px; font-size: 16px; margin-left: 640px; background: Darkred;"
onclick="deleteGroup(${groupId})">Delete</button>
                        `;
                        manageGroupBox.prepend(groupActions);
                    }
                    // Display joined users
                    const joinedUsersList = document.getElementById('joinedUsersList');
joinedUsersList.innerHTML = '';
if (data.users && data.users.length > 0) {
    const gradientColors = [
                            "linear-gradient(135deg, #FF7EB3, #8E44AD)",
                            "linear-gradient(135deg, #FF9A8B, #FF6A88)",
                            "linear-gradient(135deg, #85FFBD, #FFFB7D)",
                            "linear-gradient(135deg, #4FACFE, #00F2FE)",
                            "linear-gradient(135deg, #F4D03F, #16A085)",
                            "linear-gradient(135deg, #FF5F6D, #FFC371)",
                            "linear-gradient(135deg, #6A11CB, #2575FC)"
                        ];

                        data.users.forEach((user, index) => {
                            const listItem = document.createElement('li');
                            listItem.style.background = gradientColors[index % gradientColors.length]; // Assign unique background
                            listItem.style.padding = '15px';
                            listItem.style.margin = '10px 0';
                            listItem.style.borderRadius = '8px';
                            listItem.style.color = 'white';
                            listItem.style.display = 'flex';
                            listItem.style.alignItems = 'center';
        listItem.innerHTML = `
           <span> <img src="${user.profile_icon || 'default-profile-icon.png'}" alt="Profile Icon" width="40" height="40" style="border-radius: 50%; margin-right: 10px;">
            <h1 style="font-size: 28px;" class="manage-group-user">${user.username}</h1>
                <button class="kick" onclick="removeUserFromGroup(${groupId}, ${user.id})">Kick</button>
<button id="block-btn-${user.id}" class="block-btn" onclick="blockUserFromChat(${groupId}, ${user.id})" style="background: red; color: white; display: block;">
    Block
</button>
</span>

        `;
        joinedUsersList.appendChild(listItem);
    });
} else {
    joinedUsersList.innerHTML = '<p>No members in this group yet.</p>';
}
const likeContainer = document.getElementById('manageGroupLikes');
            if (likeContainer) {
                likeContainer.innerHTML = `
                    <button 
                        style="width: 65px; height: 65px; margin-left: 0;" 
                        id="like-btn-${groupId}" 
                        onclick="likeGroup(${groupId})" 
                        class="like-button ${data.liked ? 'liked' : ''}">
                        <i class="fa-solid fa-heart"></i>
                        <span id="like-count-${groupId}">${data.likes}</span>
                    </button>
                `;
            }
            document.getElementById('blockedUsersBtn').addEventListener('click', function () {
                fetchBlockedUsers(groupId);
                document.getElementById('blockedUsersModal').style.display = 'block';
            });

                } else {
                    alert(data.message || 'Failed to fetch group details.');
                }
            } catch (error) {
                console.error('Error parsing JSON:', error, 'Raw Data:', rawData);
                alert('An error occurred while processing the response.');
            }
        })
        .catch(error => {
            console.error('Error fetching group details:', error);
            alert('An error occurred. Please try again later.');
        });
}

// Back Button to Return to the Group List
// Back Button to Return to the Search Section
document.getElementById('backToGroupsBtn').addEventListener('click', function () {
    // Hide the manage group section
    document.getElementById('manageGroupBox').classList.remove('active');

    // Show the search section and reset chat section
    document.getElementById('yourGroups').classList.add('active');
    document.getElementById('search-section').classList.remove('active');
    document.getElementById('chat-section').classList.remove('active');

    // Reattach event listeners for search and chat functionality
    attachEventListenersToSearchAndChat();
});

document.getElementById('backToGroups').addEventListener('click', function () {
    // Hide the manage group section
document.getElementById('manageGroupBox').classList.remove('active');
    // Show the search section and reset chat section
    document.getElementById('yourGroups').classList.remove('active');
    document.getElementById('search-section').classList.add('active');
    document.getElementById('chat-section').classList.remove('active');

    // Reattach event listeners for search and chat functionality
    attachEventListenersToSearchAndChat();
});

function attachEventListenersToSearchAndChat() {
    // Ensure search functionality works
    document.querySelectorAll('.chat-button').forEach(button => {
        button.addEventListener('click', function () {
            const userId = this.getAttribute('data-user-id');
            if (userId) {
                // Show chat section and load chat
                document.getElementById('chat-section').classList.add('active');
                loadChat(userId);
            }
        });
    });
}

document.addEventListener("DOMContentLoaded", function () {
    const themeToggle = document.getElementById("theme-switch");
    

    // Load saved theme from localStorage
    const savedTheme = localStorage.getItem("theme");

    if (savedTheme === "dark") {
        document.body.classList.add("dark-theme");
        themeToggle.checked = true;  // ✅ Keep toggle switched ON
        
    } else {
        document.body.classList.remove("dark-theme");
        themeToggle.checked = false; // ✅ Keep toggle switched OFF
        
    }

    // Toggle theme when user clicks the switch
    themeToggle.addEventListener("change", function () {
        if (this.checked) {
            document.body.classList.add("dark-theme");
            localStorage.setItem("theme", "dark");
            
        } else {
            document.body.classList.remove("dark-theme");
            localStorage.setItem("theme", "light");
            
        }
    });
});
// Function to kick a user from the group
function removeUserFromGroup(groupId, userId) {    

    // Ensure userId is not undefined
    if (userId === undefined || userId === null) {
        console.error('Error: User ID is undefined or null.');
        return;
    }
const confirmKick = confirm(`Are you sure you want to kick?`);
        if (!confirmKick) return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            action: 'remove_user',
            group_id: groupId,
            user_id: userId
        }),
    })
        .then(response => response.json())
        .then(data => {
            // Log the raw JSON data in the console

            if (data.success) {
                alert(data.message || 'member removed successfully.');
                fetchGroupDetails(groupId); // Refresh group details
            } else {
                alert(data.message || 'Failed to remove user.');
            }
        })
        .catch(error => {
            console.error('Error removing user:', error);
        });
}

document.getElementById('back').addEventListener('click', function () {
    // Hide the group chat section
    document.getElementById('chat-group-section').classList.remove('active');

    // Show the group list or search section
    document.getElementById('search-section').classList.add('active');

    // Optional: Clear the current group data
    document.getElementById('groupName').textContent = '';
    document.getElementById('groupIcon').src = 'default-group-icon.png';
    document.getElementById('groupmessages').innerHTML = '';
});

function blockUserFromChat(groupId, userId) {
const blockBtn = document.getElementById(`block-btn-${userId}`);
    const unblockBtn = document.getElementById(`unblock-btn-${userId}`);

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'block_user', group_id: groupId, user_id: userId }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('This member has been blocked from the chat.');
            if (unblockBtn) unblockBtn.style.display = 'block'; // Show Unblock button
            fetchGroupDetails(groupId); // Refresh group members list
        } else {
            alert(data.message || 'Failed to block user.');
        }
    })
    .catch(error => console.error('Error blocking user:', error));
}

function unblockUserFromChat(groupId, userId) {
const blockBtn = document.getElementById(`block-btn-${userId}`);
    const unblockBtn = document.getElementById(`unblock-btn-${userId}`);

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'unblock_user', group_id: groupId, user_id: userId }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('User has been unblocked from the chat.');
            if (blockBtn) blockBtn.style.display = 'block'; // Show Block button
        } else {
            alert(data.message || 'Failed to unblock user.');
        }
    })
    .catch(error => console.error('Error unblocking user:', error));
}


function fetchBlockedUsers(groupId) {

    fetch("backend.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            action: "fetch_blocked_users",
            group_id: parseInt(groupId) // Ensure it's an integer
        })
    })
    .then(response => response.json())
    .then(data => {

        const blockedUsersList = document.getElementById("blockedUsersList");
        blockedUsersList.innerHTML = "";

        if (data.success && data.users.length > 0) {
            data.users.forEach(user => {
                blockedUsersList.innerHTML += `
                    <div style="display: flex; align-items: center; margin: 10px 0;">
                        <img src="${user.profile_icon}" width="50" height="50" style="border-radius: 50%; margin-right: 10px; object-fit: cover;">
           <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <span>${user.username}</span>
    <button style="width: 100px; height: 50px; font-size: 15px; background: green; color: white; margin-left: 10px;"
        onclick="unblockUserFromChat(${groupId}, ${user.user_id})">
        Unblock
    </button>
</div>
                    </div>
                `;
            });
        } else {
            blockedUsersList.innerHTML = "<p>No blocked users.</p>";
        }
    })
    .catch(error => console.error("Error fetching blocked users:", error));
}

// Close Blocked Users Modal
document.getElementById("closeBlockedUsersModal").addEventListener("click", function () {
    document.getElementById("blockedUsersModal").style.display = "none";
});

// Function to show image in modal
function showImageModal(imageSrc) {
    const modal = document.getElementById('fullViewModal');
    const modalContent = document.getElementById('modalMediaContent');

    // Set image inside modal
    modalContent.innerHTML = `<img src="${imageSrc}" style="width:100%; height:100%; border-radius:8px;">`;

    // Display modal
    modal.style.display = "flex";
}

// Close modal when clicking the close button
document.getElementById('closeFullViewModal').addEventListener('click', function() {
    document.getElementById('fullViewModal').style.display = "none";
});

// Close modal when clicking outside the image
document.getElementById('fullViewModal').addEventListener('click', function(event) {
    if (event.target === this) {
        this.style.display = "none";
    }
});

function leaveGroup(groupId) {
    const userId = sessionStorage.getItem('user_id');

    if (!groupId || !userId) {
        alert(`Error: Missing Group ID (${groupId}) or User ID (${userId})`);
        return;
    }


    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `action=leave_group&group_id=${groupId}&user_id=${userId}`
    })
    .then(res => res.json())
    .then(data => {
        console.log("Server Response:", data);
        if (data.success) {
            alert('Left the group successfully.');
            fetchJoinedGroups(); // Refresh UI
         document.getElementById('chat-group-section').classList.remove('active');
         document.getElementById('group-settings').classList.remove('active');
         document.getElementById('search-section').classList.add('active');
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => console.error('Fetch error:', error));
}

function deleteGroup(groupId) {

    if (!groupId) {
        console.error("Error: Group ID is undefined or null.");
        alert("Error: Group ID is missing.");
        return;
    }

    if (!confirm("Are you sure you want to delete this group? This action cannot be undone.")) return;

    fetch("backend.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            action: "delete_group",
            group_id: groupId // ✅ Only sending group_id
        }),
    })
    .then(response => response.text()) // Get raw JSON response
    .then(rawData => {
     const data = JSON.parse(rawData); // ✅ Parse it first
        try {
            if (data.success) {
                alert("Group deleted successfully!");
                location.reload();
            } else {
                alert("Failed to delete group: " + data.message);
            }
        } catch (error) {
            console.error("Error parsing JSON:", error, "Raw Data:", rawData);
            alert("An error occurred while processing the response.");
        }
    })
    .catch(error => {
        console.error("Error deleting group:", error);
        alert("An error occurred while deleting the group.");
    });
}

// Toggle Message Options Menu
function toggleMessageMenu(icon) {
    let menu = icon.nextElementSibling;
    
    // Close all other open menus
    document.querySelectorAll('.message-menu').forEach(m => {
        if (m !== menu) m.style.display = 'none';
    });

    // Toggle the clicked menu
    let isOpen = menu.style.display === "block";
    menu.style.display = isOpen ? "none" : "block";

    // Stop auto-refresh when a menu is open
    if (!isOpen) {
        clearInterval(messageInterval); // Stop auto-refresh
    } else {
        // Restart refresh based on active chat type
        if (document.getElementById("chat-section").style.display === "block") {
            messageInterval = setInterval(fetchMessages, 1000); // Private chat
        } else if (document.getElementById("chatGroupSection").style.display === "block") {
            messageInterval = setInterval(fetchGroupMessages, 1000); // Group chat
        }
    }
}



// Edit Message Function
function editMessage(button, messageId, currentMessage) {
    let newMessage = prompt("Edit your message:", currentMessage);
    if (newMessage === null || newMessage.trim() === "") return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'edit_message', message_id: messageId, new_message: newMessage })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Message updated!");
            button.closest(".message-menu").style.display = "none"; // Hide menu
            fetchMessages(); // Refresh messages
        } else {
            alert("Failed to edit message.");
        }
    })
    .catch(error => console.error('Error:', error));
}

// Delete Message Function
function deleteMessage(messageId, button) {
    if (!confirm("Are you sure you want to delete this message?")) return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'delete_message', message_id: messageId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Message deleted!");
            button.closest(".message-menu").style.display = "none"; // Hide menu
            fetchMessages(); // Refresh messages            
        } else {
            alert("Failed to delete message.");
        }
    })
    .catch(error => console.error('Error:', error));
}


function editGroupMessage(button, messageId, currentMessage) {
    let newMessage = prompt("Edit your message:", currentMessage);
    if (newMessage === null || newMessage.trim() === "") return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'edit_group_message', message_id: messageId, new_message: newMessage })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Message updated!");
            button.closest(".message-menu").style.display = "none"; // Hide menu
            fetchGroupMessages(); 
        } else {
            alert("Failed to edit message.");
        }
    })
    .catch(error => console.error('Error:', error));
}

function deleteGroupMessage(messageId, button) {
    if (!confirm("Are you sure you want to delete this message?")) return;

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'delete_group_message', message_id: messageId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Message deleted!");
            button.closest(".message-menu").style.display = "none"; // Hide menu
            fetchGroupMessages();
        } else {
            alert("Failed to delete message.");
        }
    })
    .catch(error => console.error('Error:', error));
}

document.getElementById('public-groups-btn').addEventListener('click', function () {
    document.getElementById('search-section').classList.remove('active');
    document.getElementById('public-group-section').classList.add('active');
});

document.getElementById('back-search').addEventListener('click', function () {
    document.getElementById('public-group-section').classList.remove('active');
    document.getElementById('search-section').classList.add('active');
});

document.getElementById('search-public-group').addEventListener('input', function () {
    let query = this.value.toLowerCase();
    let groupItems = document.querySelectorAll('.group-item'); //  Corrected selector

    groupItems.forEach(item => {
        let groupName = item.querySelector('h4').textContent.toLowerCase();
        let groupDescription = item.querySelector('p').textContent.toLowerCase();

        if (groupName.includes(query) || groupDescription.includes(query)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
});


function likeGroup(groupId) {
    const userId = sessionStorage.getItem('user_id');

    if (!userId) {
        alert('You must be logged in to like a group.');
        return;
    }

    fetch('backend.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'like_group', user_id: userId, group_id: groupId }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById(`like-count-${groupId}`).textContent = data.likes;

            //  Update Like Button Appearance
            const likeButton = document.querySelector(`.heart-btn[data-group-id="${groupId}"]`);
            if (likeButton) {
                likeButton.classList.toggle("liked", data.liked);
            }

            //  Refresh Public Groups List
            fetchPublicGroups();
            fetchGroupDetails(groupId); // Refresh Manage Group Section
        } else {
            alert(data.message);
        }
    })
    .catch(error => console.error('Error liking group:', error));
}

// Sidebar Toggle
const sidebar = document.getElementById("sidebar");
const menuBtn = document.getElementById("menuBtn");
const openManageGroups = document.getElementById("openManageGroups");

// Toggle Sidebar when Clicking Menu Button
menuBtn.addEventListener("click", (event) => {
    if (sidebar.style.display === "none" || sidebar.style.display === "") {
        sidebar.style.display = "block"; // Show the sidebar
        setTimeout(() => {
            sidebar.classList.add("active"); // Slide in after display change
        }, 10);
    } else {
        sidebar.classList.remove("active"); // Slide out first
        setTimeout(() => {
            sidebar.style.display = "none"; // Hide it after animation
        }, 300);
    }
    event.stopPropagation(); // Prevent closing when clicking the button
});

// Close Sidebar when Clicking Outside
document.addEventListener("click", (event) => {
    if (!sidebar.contains(event.target) && !menuBtn.contains(event.target)) {
        sidebar.classList.remove("active");
        setTimeout(() => {
            sidebar.style.display = "none"; // Hide it after animation
        }, 300);
    }
});

// Navigate to Manage Groups
openManageGroups.addEventListener("click", (event) => {
    sidebar.classList.remove("active");
    setTimeout(() => {
        sidebar.style.display = "none"; // Hide after animation
    }, 300);
    showSection("yourGroups");
    event.stopPropagation();
});

function keepUserOnline() {
    const userId = sessionStorage.getItem("user_id");
    if (!userId) return;

    fetch("backend.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "update_online", user_id: userId })
    })
    .catch(error => console.error(" Error updating online status:", error));
}

//  Send request every 1 second to keep the user online
setInterval(keepUserOnline, 1000);


function setUserOffline() {
    const userId = sessionStorage.getItem("user_id");
    if (!userId) return;

    fetch("backend.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "set_offline", user_id: userId })
    })
    .then(response => response.json())
    .then(data => {
        
    })
    .catch(error => console.error(" Error updating offline status:", error));
}

//  If the user is inactive for 30 seconds, set them offline
let inactivityTimer;
function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(setUserOffline, 30000); // 30 seconds = Offline
}

document.addEventListener("mousemove", resetInactivityTimer);
document.addEventListener("keypress", resetInactivityTimer);


//  Function to Fetch & Display User's Online Status
function fetchUserStatus(userId) {
    fetch("backend.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "get_status", user_id: userId })
    })
    .then(response => response.json())
    .then(data => {
        //  Get all elements with this user�s status (Chat + Notifications)
        const statusElements = document.querySelectorAll(`[id="user-status-${userId}"]`);

        if (statusElements.length === 0) return; //  Don't update if no elements exist

        statusElements.forEach(statusElement => {
            //  Prevent status from refreshing if it's the same
            if (statusElement.getAttribute("data-status") !== data.status) {
                statusElement.setAttribute("data-status", data.status); //  Store last status
                statusElement.innerHTML = data.status.includes("Online") 
                    ? `<i class="fas fa-circle" style="color: green;"></i> Online` 
                    : `<i class="fas fa-circle" style="color: gray;"></i> ${data.status}`;
            }
        });
    })
    .catch(error => console.error(" Error fetching user status:", error));
}

//  Fetch user status every 1 second
setInterval(() => {
    const userId = sessionStorage.getItem("user_id");
    if (userId) {
        fetchUserStatus(userId);
    }
}, 1000);


//  Fetch user status every 1 second
//  Fetch user status every 1 second

//  Function to Start Checking Status Every 10 Seconds
function startStatusCheck() {
    const userId = sessionStorage.getItem("user_id");
    if (userId) {
        // Mark user online
        fetchUserStatus(userId); // Fetch initial status
        setInterval(() => fetchUserStatus(userId), 1000); // Refresh every 10 sec
    }
}

// Run when the page loads
document.addEventListener("DOMContentLoaded", startStatusCheck);


// Show Friend Requests Section
document.addEventListener("click", function (event) {
    if (event.target.classList.contains("send-request")) {
        const userId = event.target.dataset.userid;
        const senderId = sessionStorage.getItem("user_id");

        if (!senderId) {
            alert("You must be logged in to send friend requests.");
            return;
        }


        event.target.textContent = "Sending...";
        event.target.disabled = true;

        fetch("friends.php?action=send_request", {
            method: "POST",
            body: JSON.stringify({ sender_id: senderId, receiver_id: userId }),
            headers: { "Content-Type": "application/json" }
        })
        .then(response => response.text()) // Read response as text first
        .then(text => {
            console.log("Server Response:", text);

            if (!text.trim()) {
                throw new Error("Empty response from server");
            }

            return JSON.parse(text);
        })
        .then(data => {
            if (data.success) {
                event.target.textContent = "Request Sent";
            } else {
                event.target.textContent = "Send Request";
                event.target.disabled = false;
                alert(data.error || "Failed to send request.");
            }
        })
        .catch(error => {
            console.error("Fetch Error:", error);
            event.target.textContent = "Send Request";
            event.target.disabled = false;
        });
    }
});


function fetchFriendRequests() {
    const userId = sessionStorage.getItem("user_id");

    if (!userId) {
        console.error("User ID is missing from sessionStorage");
        return;
    }

    fetch("friends.php?action=fetch_requests", {
        method: "POST",
        body: JSON.stringify({ user_id: userId }),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            console.error("Server Error:", data.message);
            return;
        }

        const list = document.getElementById("friendRequestsList");
        list.innerHTML = ""; // Clear previous requests to prevent duplicates

        if (!Array.isArray(data.requests) || data.requests.length === 0) {
            list.innerHTML = "<p>No friend requests.</p>";
            return;
        }

        // Create a Set to store unique sender IDs
        const uniqueRequests = new Set();

        data.requests.forEach(request => {
            if (!uniqueRequests.has(request.sender_id)) {
                uniqueRequests.add(request.sender_id);

                const div = document.createElement("div");
                div.classList.add("friend-request");
                div.innerHTML = `
                    <img src="${request.profile_icon}" alt="Profile" style="width: 50px; height: 50px; border-radius: 50%;">
                    <span>${request.username}</span>
                    <div style="display: flex; justify-content: space-between; width: 100%; padding: 10px;">
<button style="width: 120px; height: 50px; font-size: 18px; background: linear-gradient(135deg, #007BFF, #0056b3); color: white; border: none; border-radius: 8px; cursor: pointer;" class="accept" data-id="${request.id}" data-user="${request.sender_id}">Accept</button>
  <button style="width: 120px; height: 50px; font-size: 18px; background: linear-gradient(135deg, #ff416c, #ff4b2b); color: white; border: none; border-radius: 8px; cursor: pointer;" class="decline" data-id="${request.id}">Decline</button>
  </div>
                `;
                list.appendChild(div);
            }
        });

        // Attach event listeners for Accept & Decline buttons
        document.querySelectorAll(".accept").forEach(button => {
            button.addEventListener("click", function() {
                handleFriendRequest("accept", this.dataset.id, this.dataset.user, this.parentElement);
            });
        });

        document.querySelectorAll(".decline").forEach(button => {
            button.addEventListener("click", function() {
                handleFriendRequest("decline", this.dataset.id, null, this.parentElement);
            });
        });
    })
    .catch(error => console.error("Fetch Error:", error));
}

// Fetch Friend Requests
function fetchFriendRequests() {
    const userId = sessionStorage.getItem("user_id");
    if (!userId) {
        console.error("User ID is missing from sessionStorage");
        return;
    }

    fetch("friends.php?action=fetch_requests", {
        method: "POST",
        body: JSON.stringify({ user_id: userId }),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            console.error("Server Error:", data.message);
            return;
        }

        const list = document.getElementById("friendRequestsList");
        list.innerHTML = ""; // Clear previous requests

        if (!data.requests.length) {
            list.innerHTML = "<p>No friend requests.</p>";
            return;
        }

        data.requests.forEach(request => {
            const div = document.createElement("div");
            div.innerHTML = `
                <img src="${request.profile_icon}" alt="Profile" width="50" height="50">
                <span>${request.username}</span>
               <div style="display: flex; justify-content: space-between; width: 100%; padding: 10px;">
<button style="width: 120px; height: 50px; font-size: 18px; background: linear-gradient(135deg, #007BFF, #0056b3); color: white; border: none; border-radius: 8px; cursor: pointer;" class="accept" onclick="handleFriendRequest(${request.id}, 'accept')">Accept</button>
  <button style="width: 120px; height: 50px; font-size: 18px; background: linear-gradient(135deg, #ff416c, #ff4b2b); color: white; border: none; border-radius: 8px; cursor: pointer;" class="decline" onclick="handleFriendRequest(${request.id}, 'decline')">Decline</button>
  </div>
            `;
            list.appendChild(div);
        });
    })
    .catch(error => console.error("Fetch Error:", error));
}

// Handle Accept/Decline
function handleFriendRequest(requestId, action) {
    fetch(`friends.php?action=${action}_request`, {
        method: "POST",
        body: JSON.stringify({ request_id: requestId }),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            fetchFriendRequests(); //  Refresh friend requests list
            fetchFriendsList(); //  Refresh friends list
        } else {
            alert(data.message);
        }
    })
    .catch(error => console.error("Fetch Error:", error));
}

// Fetch Friends List
function fetchFriendsList() {
    const userId = sessionStorage.getItem("user_id");
    if (!userId) return;

    fetch("friends.php?action=fetch_friends", {
        method: "POST",
        body: JSON.stringify({ user_id: userId }),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
        const friendsList = document.getElementById("friendsList");

        if (!friendsList) {
            console.error("Error: Friends List element not found.");
            return;
        }

        friendsList.innerHTML = ""; // Clear previous list

        if (!data.success || !data.friends.length) {
            friendsList.innerHTML = "<p>You have no friends yet.</p>";
            return;
        }

        data.friends.forEach(friend => {
            const div = document.createElement("div");
            div.classList.add("friend-item");
            div.setAttribute("data-friend-id", friend.id); // ✅ Ensure `data-friend-id` is set
            
            div.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; width: 100%; padding: 10px; border-bottom: 1px solid #444;">
            <img src="${friend.profile_icon}" alt="Profile" width="50" height="50" style="border-radius: 50%;">

            <div style="flex-grow: 1; margin-left: 10px;">
                <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                    <span style="font-weight: bold; color: white;">${friend.username}</span>
                       </div>
                     <p id="user-status-${friend.id}" class="user-status" style="margin: 5px 0 0 0; font-size: 14px; color: #ccc;">Checking...</p>
               </div>
        </div>
            `;
           
            friendsList.appendChild(div);

            //  Fetch and update status for each friend
            fetchUserStatus(friend.id);
        });
    })
    .catch(error => console.error("Fetch Error:", error));
}

$(document).on("click", ".three-dots-button", function () {
    // Toggle the details box for the clicked button
    $(this).next(".details-box").toggle();
});

// Hide details-box when clicking outside
$(document).click(function (e) {
    if (!$(e.target).closest('.three-dots-button, .details-box').length) {
        $(".details-box").hide();
    }
});

// Handle Chat & Remove button clicks
$(document).on("click", ".chat-button, .remove-button", function () {
    let parentBox = $(this).closest(".details-box").prev(".three-dots-button");
    let userId = parentBox.attr("data-user-id");
    let friendId = parentBox.attr("data-friend-id");

    if (!userId || !friendId) {
        alert("Missing user id or friend id");
        return;
    }

    console.log("User ID:", userId, "Friend ID:", friendId);

    // Perform chat or remove actions here...
});
 
function removeFriends(friendId) {
    if (!confirm("Are you sure you want to remove this friend?")) return;

    fetch('friends.php?action=remove_friend', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            user_id: sessionStorage.getItem('user_id'),
            friend_id: friendId
        }),
    })
    .then(response => response.text()) // Get raw response text
    .then(text => {
        let data;
        try {
            data = JSON.parse(text);
        } catch (error) {
            console.error("JSON Parse Error:", error, text);
            return;
        }
        console.log("Parsed JSON:", data);

        if (data.success) {
            alert("Friend removed successfully.");
            
            let friendItem = document.querySelector(`[data-friend-id="${friendId}"]`);
            if (friendItem) friendItem.remove();

            // ✅ Hide dropdown
            document.querySelector(".friends-info-dropdown").classList.remove("visible");

            fetchFriendsList();
            
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(error => console.error('Fetch Error:', error));
}


// Fetch requests & friends list on page load


document.getElementById("friendRequestsBtn").addEventListener("click", function() {
    // Hide unwanted sections
    document.getElementById("search-section")?.classList.remove("active");
    document.getElementById("public-group-section")?.classList.remove("active");
    document.getElementById("manageGroupBox")?.classList.remove("active");

    // Show only the Friend Requests section
    document.getElementById("friendRequestsSection").classList.add("active");

    // Fetch friend requests
    fetchFriendRequests();
    fetchGroupInvitations();
});

document.getElementById("friendsBtn").addEventListener("click", function() {
    // Hide unwanted sections
    document.getElementById("chat-section")?.classList.remove("active");

    document.getElementById("search-section")?.classList.remove("active");
    document.getElementById("public-group-section")?.classList.remove("active");
    document.getElementById("manageGroupBox")?.classList.remove("active");
    document.getElementById("friend-requests-section")?.classList.remove("active");

    // Show only the Friends List section
    document.getElementById("friendsListSection")?.classList.add("active");
    // Fetch and display the friends list
    fetchFriendsList();
});

function goBackToSearch() {
    // Hide Friend Requests & Friends List sections
    document.getElementById("friendRequestsSection")?.classList.remove("active");
    document.getElementById("friendsListSection")?.classList.remove("active");
    document.getElementById("chat-section")?.classList.remove("active");
    document.getElementById("invitationSection")?.classList.remove("active");

    // Show Search Section
    document.getElementById("search-section")?.classList.add("active");
}
document.addEventListener("click", function(event) {
    if (event.target.classList.contains("chat-btn")) {
        document.getElementById("friendsListSection")?.classList.remove("active");
        
    }
});

document.getElementById("fetchfriendsBtn").addEventListener("click", function () {
    fetchFriendsForModal(); //  Always fetch fresh data from PHP
    document.getElementById("fetchFriends").classList.add("active");
    document.getElementById("modalOverlay").classList.add("active");
});

document.getElementById("modalOverlay").addEventListener("click", function () {
    document.getElementById("fetchFriends").classList.remove("active");
    document.getElementById("modalOverlay").classList.remove("active");
});

function fetchFriendsForModal() {
    const userId = sessionStorage.getItem("user_id");
    if (!userId) return;

    fetch("friends.php?action=fetch_friends", {
        method: "POST",
        body: JSON.stringify({ user_id: userId }),
        headers: { "Content-Type": "application/json" }
    })
    .then(response => response.json())
    .then(data => {
        const fetchFriendsContainer = document.getElementById("FetchFriends");

        if (!fetchFriendsContainer) {
            console.error("Error: Fetch Friends container not found.");
            return;
        }

        fetchFriendsContainer.innerHTML = ""; // Clear previous list

        if (!data.success || !data.friends.length) {
            fetchFriendsContainer.innerHTML = "<p>You have no friends yet.</p>";
            return;
        }

        data.friends.forEach(friend => {
            const div = document.createElement("div");
            div.classList.add("friend-item");
            div.innerHTML = `
               <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 10px; border-bottom: 1px solid #444;">
    <img src="${friend.profile_icon}" alt="Profile" width="50" height="50" style="border-radius: 50%;">
    <div style="flex-grow: 1; margin-left: 10px; display: flex; align-items: center;">
        <span style="font-weight: bold; color: darkRed;">${friend.username}</span>
    </div>
<button class="invitation-btn" data-friend-id="${friend.id}" style="width: auto; min-width: 120px; height: 40px; margin-left: 15px; padding: 5px 10px; font-size: 16px;"> Send Invitation </button>
</div>

            `;
            fetchFriendsContainer.appendChild(div);
        });
    })
    .catch(error => console.error("Fetch Error:", error));
}


// Close dropdown when clicking outside

document.addEventListener("click", function (event) {
    if (event.target.classList.contains("invitation-btn")) {
        let inviterId = sessionStorage.getItem("user_id"); // Get logged-in user ID
        let groupId = currentGroupId; // Use `currentGroupId`
        let friendId = event.target.getAttribute("data-friend-id"); // Try to get `friend_id` first
        let buttonElement = event.target; // Store button reference

        // If `friend_id` is missing, fallback to getting the username
        if (!friendId) {
            let friendElement = event.target.closest(".friend-item");
            let friendUsername = friendElement ? friendElement.querySelector("span").textContent.trim() : null;

            if (!friendUsername) {
                alert("Error: Unable to fetch friend details.");
                return;
            }

            // Fetch `friend_id` from backend using username
            fetch("friends.php?action=get_friend_id", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username: friendUsername })
            })
            .then(res => res.json())
            .then(data => {
                if (!data.success) {
                    alert(data.message);
                    return;
                }
                friendId = data.friend_id; // Set the correct `friend_id`
                sendGroupInvite(inviterId, groupId, friendId, buttonElement); // Pass button reference
            })
            .catch(error => console.error("Error fetching friend ID:", error));
        } else {
            sendGroupInvite(inviterId, groupId, friendId, buttonElement); // Pass button reference
        }
    }
});

function sendGroupInvite(inviterId, groupId, friendId, buttonElement) {
    let requestData = { inviter_id: inviterId, group_id: groupId, invitee_id: friendId };

    fetch("friends.php?action=send_group_invite", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Group invitation sent successfully!");
            buttonElement.textContent = "Invitation Sent"; // Update button text
            buttonElement.disabled = true; // Disable button to prevent duplicate invites
        } else {
            alert(data.message);
        }
    })
    .catch(error => console.error("Error:", error));
}


function fetchGroupInvitations() {
    let userId = sessionStorage.getItem('user_id');

    if (!userId) {
        alert("User not logged in!");
        return;
    }

    fetch('friends.php?action=fetch_group_invites', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: userId })
    })
    .then(response => response.json())
    .then(data => {
        let inviteList = document.getElementById("inviteList");
        inviteList.innerHTML = ""; // Clear previous invites

        if (data.success) {
            if (data.invites.length === 0) {
                inviteList.innerHTML = "<li style='color: white; padding: 10px;'>No group invitations</li>";
            } else {
                data.invites.forEach(invite => {
                    let inviteItem = document.createElement("li");
                       inviteItem.setAttribute("data-group-name", invite.group_name);

                    inviteItem.innerHTML = `
<div style="background: #1e1e1e; border-radius: 12px; padding: 16px; margin-bottom: 16px; color: white; box-shadow: 0 0 10px rgba(0,0,0,0.4);">
    <div style="display: flex; align-items: center;">
        <img src="${invite.group_icon}" alt="Group Icon" width="60" height="60" style="border-radius: 50%; object-fit: cover; border: 2px solid #ccc;">
        <div style="margin-left: 16px;">
            <div style="font-size: 20px; font-weight: bold;">${invite.group_name}</div>
            <div style="font-size: 14px; color: #ccc; margin-top: 5px;">${invite.group_description}</div>
            <div style="font-size: 13px; color: #999;">Privacy: <b>${invite.group_privacy}</b></div>
        </div>
    </div>

    <div style="display: flex; align-items: center; margin-top: 15px;">
        <img src="${invite.inviter_icon}" alt="Inviter Icon" width="40" height="40" style="border-radius: 50%; object-fit: cover; border: 2px solid #888;">
        <span style="margin-left: 10px; font-size: 15px;">Invited by <b>${invite.inviter_name}</b></span>
    </div>

    <button class="join-group-btn" style="margin-top: 15px; background: #00b894; color: white; font-size: 16px; border: none; border-radius: 8px; padding: 10px 20px; cursor: pointer;" data-group-id="${invite.group_id}">ACCEPT</button>
</div>
`;

                    inviteList.appendChild(inviteItem);
                });
            }
        } else {
            alert(data.message || "Failed to fetch invitations");
        }
    })
    .catch(error => {
        console.error("Error fetching group invites:", error);
    });
}


document.getElementById("inviteList").addEventListener("click", function (event) {
    if (event.target.classList.contains("join-group-btn")) {
        const inviteItem = event.target.closest("li"); // Get the invite list item

        if (!inviteItem) return;

        const groupName = inviteItem.getAttribute("data-group-name"); // Get group name
        const userId = sessionStorage.getItem("user_id"); // Get user ID


        if (!userId || !groupName) {
            alert("Error: Missing user or group details.");
            return;
        }

        fetch("backend.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                action: "join_group", 
                user_id: userId, 
                group_name: groupName 
            })
        })
        .then(response => response.json()) //  Read response as JSON directly
        .then(data => {
            console.log("Join Group Response:", data);
            if (data.success) {
                alert("Joined group successfully!");
                inviteItem.remove(); //  Remove invitation from UI
            } else {
                alert("Failed to join group: " + data.message);
            }
        })
        .catch(error => console.error("Error joining group:", error));
    }
});

window.alert = function (message, type = "success") {
    // Remove existing alerts and overlay if they exist
    document.querySelector(".custom-alert")?.remove();
    document.querySelector(".alert-overlay")?.remove();

    // Create the overlay background (clicking this will close the alert)
    let overlay = document.createElement("div");
    overlay.className = "alert-overlay";
    overlay.addEventListener("click", () => {
        alertBox.remove();
        overlay.remove();
    });

    // Create the alert box (centered)
    let alertBox = document.createElement("div");
    alertBox.className = `custom-alert ${type}`;
    alertBox.innerHTML = `<span>${message}</span>`;

    // Inject CSS if not already added
    let styleSheet = document.getElementById("custom-alert-style");
    if (!styleSheet) {
        styleSheet = document.createElement("style");
        styleSheet.id = "custom-alert-style";
        styleSheet.innerText = `
            .alert-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                z-index: 9998;
            }

            .custom-alert {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 20px 40px;
                font-size: 1.5rem;
                font-weight: bold;
                border-radius: 10px;
                box-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
                text-align: center;
                z-index: 9999;
                min-width: 300px;
                max-width: 80%;
                background: green;
                color: yellow;
            }
            
            .custom-alert.error {
                background-color: red;
                color: white;
            }
        `;
        document.head.appendChild(styleSheet);
    }

    // Append overlay and alert box to body
    document.body.appendChild(overlay);
    document.body.appendChild(alertBox);
};

document.addEventListener("DOMContentLoaded", function () {
    const chatSection = document.getElementById("messages");
    const themeDialog = document.getElementById("theme-dialog");
    const openThemeBtn = document.getElementById("open-theme-settings"); // Button to open the dialog
    const closeThemeBtn = document.getElementById("close-theme");

    // Load saved theme color
    const savedColor = localStorage.getItem("chatBackgroundColor");
    if (savedColor) chatSection.style.background = savedColor;

    // Apply new theme (color only)
    document.getElementById("apply-theme").addEventListener("click", function () {
        const color = document.getElementById("theme-color").value;
        localStorage.setItem("chatBackgroundColor", color);
        chatSection.style.background = color;
    });

    // Reset Theme
    document.getElementById("reset-theme").addEventListener("click", function () {
        localStorage.removeItem("chatBackgroundColor");
        chatSection.style.background = ""; // Reset to default
    });

    // Show Theme Dialog only when clicking "Open Theme Settings"
    openThemeBtn.addEventListener("click", function () {
        themeDialog.style.display = "flex";
    });

    // Close Theme Dialog when clicking "Close" button
    closeThemeBtn.addEventListener("click", function () {
        themeDialog.style.display = "none";
    });

    // Close dialog when clicking outside
    themeDialog.addEventListener("click", function (event) {
        if (event.target === themeDialog) {
            themeDialog.style.display = "none";
        }
    });
});

document.addEventListener("DOMContentLoaded", function () {
    const dropdown = document.querySelector(".friends-info-dropdown");

    document.body.addEventListener("click", function (event) {
        const friendItem = event.target.closest(".friend-item");
        const clickedInsideDropdown = event.target.closest(".friends-info-dropdown");

        // ✅ Hide dropdown ONLY when clicking outside both friend item and dropdown
        if (!friendItem && !clickedInsideDropdown) {
            dropdown.classList.remove("visible");
            return;
        }

        // ✅ Show dropdown when clicking on a friend item
        if (friendItem) {
            let friendId = friendItem.getAttribute("data-friend-id");

            if (!friendId) {
                return;
            }
            // ✅ Update dropdown with correct friend info
            dropdown.setAttribute("data-friend-id", friendId);
            dropdown.querySelector(".friend-username").innerText = friendItem.querySelector("span").innerText;
            dropdown.querySelector(".friend-profile-icon").src = friendItem.querySelector("img").src;
           
            // ✅ Set correct friend ID in buttons
            dropdown.querySelector(".remove-friend-btn").dataset.friendId = friendId;
            dropdown.querySelector(".chat-friend-btn").dataset.friendId = friendId;
             dropdown.querySelector(".block-friend-btn").dataset.friendId = friendId; // ✅ Added block button
             
            dropdown.classList.add("visible"); 
           
 fetch("friends.php?action=fetch_friend_about", {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        user_id: sessionStorage.getItem("user_id"),
        friend_id: friendId
    })
})
.then(response => response.json())
.then(data => {
    if (data.success && data.about) {
        dropdown.querySelector(".friend-about-text").innerText = data.about;
    } else {
        dropdown.querySelector(".friend-about-text").innerText = "No about info set yet.";
    }
})
.catch(error => {
    console.error("Error fetching about:", error);
    dropdown.querySelector(".friend-about-text").innerText = "Error loading about.";
});

            // ✅ Fetch mutual friends count and display it inside dropdown
            fetch(`friends.php?action=count_friends&user_id=${sessionStorage.getItem("user_id")}`)
                .then(response => response.json())
                .then(data => {
                    if (data[friendId] !== undefined) {
                        dropdown.querySelector(".mutual-friend").innerText = `${data[friendId]} Friends`;
                    } else {
                        dropdown.querySelector(".mutual-friend").innerText = `0  Friends`;
                    }
                })
                .catch(error => console.error("Error:", error));
        


// ✅ Show when the friendship was created
fetch("friends.php?action=fetch_friends", {
    method: "POST",
    headers: {
        "Content-Type": "application/json"
    },
    body: JSON.stringify({
        user_id: sessionStorage.getItem("user_id")
    })
})
.then(response => response.json())
.then(data => {
    if (data.success) {
        let friendInfo = data.friends.find(f => f.id === Number(friendId));
        if (friendInfo && friendInfo.created_at) {
            const date = new Date(friendInfo.created_at);
            dropdown.querySelector(".member-since").innerText = `Friends since: ${date.toLocaleString()}`;
        } else {
            dropdown.querySelector(".member-since").innerText = "Friends since: unknown";
        }
    }
})
.catch(error => {
    console.error("Error fetching friendship time:", error);
    dropdown.querySelector(".member-since").innerText = "Friends since: error";
});
}
    // ✅ Remove friend and hide dropdown
    });
function blockFriend(friendId) {
    let userId = sessionStorage.getItem("user_id"); // ✅ Ensure user ID is retrieved

    if (!userId || !friendId) {
        console.error("❌ ERROR: Missing user ID or friend ID.");
        return;
    }

    fetch("friends.php?action=block_friend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            user_id: userId,
            blocked_user_id: friendId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("✅ your Friend has been blocked.");
        } else if (data.message === "your friend is already blocked") {  
            alert("your friend is already blocked.");
        } else {
            alert(data.message);
        }
    })
    .catch(error => console.error("❌ Fetch error:", error));
}

function unblockFriend(friendId) {
    let userId = sessionStorage.getItem("user_id"); // ✅ Ensure user ID is retrieved

    if (!userId || !friendId) {
        console.error("❌ ERROR: Missing user ID or friend ID.");
        return;
    }

    fetch("friends.php?action=unblock_friend", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            user_id: userId,
            blocked_user_id: friendId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("✅ your Friend has been unblocked.");
        } 
    })
    .catch(error => console.error("❌ Fetch error:", error));
}
document.getElementById('blockedFriendsbtn').addEventListener('click', function () {
                document.getElementById('blockedFriendsModal').style.display = 'block';
                fetchBlockedFriends()
            });
            document.getElementById("closeBlockedFriendsModal").addEventListener("click", function () {
    document.getElementById("blockedFriendsModal").style.display = "none";
});
window.addEventListener("click", function (event) {
    const modal = document.getElementById("blockedFriendsModal");
    if (event.target === modal) {
        modal.style.display = "none";
    }
});
function fetchBlockedFriends() {
    let userId = sessionStorage.getItem("user_id"); 

    if (!userId) {
        console.error("❌ ERROR: Missing user ID.");
        return Promise.resolve();
    }

    fetch("friends.php?action=fetch_blocked_friends", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            user_id: userId
        })
    })
    .then(response => response.json())
    .then(data => {
        fetchFriendsList();
        const blockedFriendsList = document.getElementById("blockedFriendsList");
        blockedFriendsList.innerHTML = "";

        if (data.success && data.users.length > 0) {
            data.users.forEach(user => {
                blockedFriendsList.innerHTML += `
                    <div style="display: flex; align-items: center; margin: 10px 0;">
                        <img src="${user.profile_icon}" width="50" height="50" style="border-radius: 50%; margin-right: 10px; object-fit: cover;">
           <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
    <span>${user.username}</span>
  <button style="width: 100px; height: 50px; font-size: 15px; background: green; color: white; margin-left: 10px;" class="unblock-friend-btn" data-friend-id="${user.user_id}">Unblock</button>
</div>
                    </div> 
                `;
            });
        } else {
            blockedFriendsList.innerHTML = "<p>No blocked Friends.</p>";
        }
    })
    .catch(error => console.error("❌ ERROR fetching blocked users:", error));
}
document.body.addEventListener("click", function (event) {
        if (event.target.classList.contains("remove-friend-btn")) {
            let friendId = event.target.dataset.friendId;

            removeFriends(friendId);
            // ✅ Hide dropdown after removing friend
            dropdown.classList.remove("visible");
            
            fetch(`friends.php?action=count_friends&user_id=${sessionStorage.getItem("user_id")}`)
                .then(response => response.json())
                .then(data => {
                    if (data[friendId] !== undefined) {
                        dropdown.querySelector(".mutual-friend").innerText = `${data[friendId]} Friends`;
                    } else {
                        dropdown.querySelector(".mutual-friend").innerText = `0 Friends`;
                    }
                })
                .catch(error => console.error("Error:", error));
        }
    });
document.body.addEventListener("click", function (event) {
    if (event.target.classList.contains("block-friend-btn")) {
        let dropdown = document.querySelector(".friends-info-dropdown");

        if (!dropdown) {
            console.error("❌ ERROR: `.friends-info-dropdown` not found!");
            return;
        }

        let friendId = dropdown.getAttribute("data-friend-id"); // ✅ Get friendId from dropdown

        if (!friendId) {
            console.error("❌ ERROR: Friend ID missing in dropdown!");
            return;
        }
        
        let confirmBlock = confirm("Are you sure you want to block this friend?");
        if (!confirmBlock) return;

        dropdown.classList.remove("visible");

        blockFriend(friendId);
    }
});
  
document.body.addEventListener("click", function (event) {
    if (event.target.classList.contains("unblock-friend-btn")) {
        let dropdown = document.querySelector(".friends-info-dropdown");
        let friendId = event.target.dataset.friendId;

        if (!dropdown) {
            console.error("❌ ERROR: `.friends-info-dropdown` not found!");
            return;
        }

        if (!friendId) {
            console.error("❌ ERROR: Friend ID missing in dropdown!");
            return;
        }

        let confirmBlock = confirm("Are you sure you want to unblock this friend?");
        if (!confirmBlock) return;

        dropdown.classList.remove("visible");

        unblockFriend(friendId);
    }
});
    // ✅ Start chat
    document.body.addEventListener("click", function (event) {
        const chatBtn = event.target.closest(".chat-friend-btn"); // Ensures it's a chat button
        if (chatBtn) {
            let friendId = chatBtn.dataset.friendId;
            if (!friendId) {
                console.error("❌ ERROR: Missing in chat button.");
                return;
            }
            startChat(friendId);
        }
    });
});

document.addEventListener("click", function (event) {
    const dropdown = document.querySelector(".friends-info-dropdown");

    if (!dropdown) {
        console.error("❌ ERROR: `.friends-info-dropdown` not found in the document!");
        return;
    }

    // ✅ Hide dropdown only if clicking outside of `.friend-item` and `.friends-info-dropdown`
    if (!event.target.closest(".friend-item") && !event.target.closest(".friends-info-dropdown")) {
        dropdown.classList.remove("visible");
    }
});

document.querySelectorAll('.chat-friend-btn').forEach(button => {
    button.addEventListener('click', () => {
        document.getElementById("friendsListSection")?.classList.remove("active");
        const dropdown = document.querySelector(".friends-info-dropdown");
        dropdown.classList.remove("visible");
    });
});

const dropdown = document.getElementById("dropdown-info");
const dragHandle = document.getElementById("dragHandle");
let startY, currentY, isDragging = false;

// Touch start event
dragHandle.addEventListener("touchstart", (e) => {
    startY = e.touches[0].clientY;
    isDragging = true;
});

// Touch move event
dragHandle.addEventListener("touchmove", (e) => {
    if (!isDragging) return;
    currentY = e.touches[0].clientY;
    let moveDiff = currentY - startY;

    if (moveDiff > 0) {
        dropdown.style.bottom = `-${moveDiff}px`;
    }
});

// Touch end event
dragHandle.addEventListener("touchend", () => {
    isDragging = false;
    const moveDiff = currentY - startY;
    const screenHeight = window.innerHeight;
    const threshold = screenHeight * 0.5; // 20% of screen height

    if (moveDiff > threshold) {
        // Move dropdown to bottom (hide)
        dropdown.classList.remove("visible");
        document.body.classList.remove("no-scroll");
    } else {
        // Keep dropdown visible
        dropdown.classList.add("visible");
    }

    dropdown.style.bottom = ""; // Reset bottom style
});
const input = document.getElementsByClassName('message-input')[0];
const sendBtn = document.getElementsByClassName('send-btn')[0];

input.addEventListener('input', () => {
  if (input.value.trim() !== "") {
    sendBtn.classList.add('active');
  } else {
    sendBtn.classList.remove('active');
  }
});

function loadGroupDetails(groupId) {
  fetch('backend.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      action: 'get_group_details',
      group_id: groupId
    })
  })
  .then(res => res.json())
  .then(data => {
    if (!data.success) {
      console.error('Error:', data.message);
      return;
    }

    const group = data.group;

    // Settings sidebar view
    document.getElementById("settingsGroupName").textContent = group.name || '';
    document.getElementById("settingsGroupDescription").textContent = group.description || '';
    document.getElementById("settingsGroupIcon").src = group.icon || 'default-group-icon.png';
    document.getElementById("settingsGroupPrivacy").textContent = group.privacy || '';
    document.getElementById("settingsGroupAdmin").textContent = group.creator?.username || 'Unknown';

    // Insert "Leave" button via innerHTML
    document.getElementById("leaveGroupButtonContainer").innerHTML = `
      <button style="width: 120px; height: 70px; font-size: 24px; background: linear-gradient(135deg, #ff416c, #ff4b2b); color: white; border: none; border-radius: 20px; cursor: pointer;" 
        onclick="leaveGroup(${groupId})">Leave</button>
    `;

    // Display Group Members
    const membersContainer = document.getElementById("groupMembersContainer");
    membersContainer.innerHTML = ''; // Clear previous members

    if (group.members && group.members.length > 0) {
      group.members.forEach(member => {
        const memberCard = document.createElement('div');
        memberCard.classList.add('member-card');

        const memberImg = document.createElement('img');
        memberImg.src = member.profile_icon || 'default-profile-icon.png';
        memberImg.alt = member.username + " Avatar";

        const memberUsername = document.createElement('span');
        memberUsername.textContent = member.username;

        memberCard.appendChild(memberImg);
        memberCard.appendChild(memberUsername);
        membersContainer.appendChild(memberCard);
      });
    } else {
      const noMembersMessage = document.createElement('span');
      noMembersMessage.textContent = "No members joined yet.";
      membersContainer.appendChild(noMembersMessage);
    }
  })
  .catch(err => {
    console.error("Failed to load group details", err);
  });
}


document.getElementById('group-sideBar-btn').addEventListener('click', () => {
	let groupId = currentGroupId;
	            document.getElementById('group-settings').classList.add('active');
            document.getElementById('chat-group-section').classList.remove('active');	
            loadGroupDetails(groupId);
});

document.getElementById('back-to-chat').addEventListener('click', () => {
    document.getElementById('group-settings').classList.remove('active');
    document.getElementById('chat-group-section').classList.add('active');
});

function toggleDropdown(show) {
    let dropdown = document.getElementById("dropdownMenu");

    if (show) {
        // Fetch user data dynamically
        document.getElementById("dropdown-profile-pic").src = document.querySelector(".manage-profile").src;
        document.getElementById("dropdown-username").textContent = document.getElementById("profile-name")?.textContent || "Username";
        document.getElementById("dropdown-email").textContent = document.getElementById("profile-email")?.textContent || "#user@ChatWithUs.com";

        dropdown.classList.add("active");
    } else {
        dropdown.classList.remove("active");
    }
}

// Open dropdown when clicking the profile icon
document.querySelector(".manage-profile").addEventListener("click", function(event) {
    event.stopPropagation(); // Prevent closing when clicking the profile icon
    toggleDropdown(true);
});

// Close dropdown when clicking outside
document.addEventListener("click", function(event) {
    let dropdown = document.getElementById("dropdownMenu");
    if (!dropdown.contains(event.target) && !document.querySelector(".manage-profile").contains(event.target)) {
        toggleDropdown(false);
    }
});

// Prevent dropdown from closing when clicking inside
document.getElementById("dropdownMenu").addEventListener("click", function(event) {
    event.stopPropagation();
});

// Save note to a cookie
// Save note to localStorage
function setNoteLocal(note) {
  localStorage.setItem("userNote", note);
}

// Get note from localStorage
function getNoteLocal() {
  return localStorage.getItem("userNote") || '';
}

// Run when page is ready
document.addEventListener("DOMContentLoaded", () => {
  const savedNote = getNoteLocal();

  // Set the saved note in both places
  const bubbleText = document.getElementById("note-text-display-bubble");
  const infoText = document.getElementById("note-text-display-info");

  if (bubbleText) bubbleText.textContent = savedNote;
  if (infoText) infoText.textContent = savedNote;
});

// Start editing the note
function editNote() {
  const noteDisplay = document.getElementById("note-display");
  if (noteDisplay) noteDisplay.style.display = "none";

  const pencilIcons = document.querySelectorAll(".edit-pencil");
  pencilIcons.forEach(icon => icon.style.display = "none");

  const currentText = document.getElementById("note-text-display-bubble")?.textContent || "";

  let noteBox = document.createElement("div");
  noteBox.classList.add("edit-note-box");

  let textarea = document.createElement("textarea");
  textarea.id = "note-text";
  textarea.placeholder = "Write your note here...";
  textarea.value = currentText;

  let saveBtn = document.createElement("button");
  saveBtn.id = "save-btn";
  saveBtn.textContent = "Save";
  saveBtn.onclick = saveNote;

  textarea.addEventListener("input", (e) => {
    setNoteLocal(e.target.value); // Save while typing
  });

  noteBox.appendChild(textarea);
  noteBox.appendChild(saveBtn);

  const noteContainer = document.getElementById("note-container");
  if (noteContainer) {
    noteContainer.innerHTML = '';
    noteContainer.appendChild(noteBox);
  }
}

// Save the note and update UI
function saveNote() {
  const noteText = document.getElementById("note-text")?.value || "";
  setNoteLocal(noteText);

  const bubbleText = document.getElementById("note-text-display-bubble");
  const infoText = document.getElementById("note-text-display-info");

  if (bubbleText) bubbleText.textContent = noteText;
  if (infoText) infoText.textContent = noteText;

  // Rebuild info-box display
  const noteDisplay = document.createElement("div");
  noteDisplay.id = "note-display";
  noteDisplay.style.display = "flex";
  noteDisplay.style.alignItems = "center";
  noteDisplay.style.gap = "6px";

  const span = document.createElement("span");
  span.className = "note-text-display-info";
  span.textContent = noteText;

  const pencil = document.createElement("i");
  pencil.className = "fas fa-pencil-alt edit-pencil";
  pencil.id = "edit-pencil-info";
  pencil.style.display = "inline";
  pencil.onclick = editNote;

  noteDisplay.appendChild(span);
  noteDisplay.appendChild(pencil);

  const noteContainer = document.getElementById("note-container");
  if (noteContainer) {
    noteContainer.innerHTML = '';
    noteContainer.appendChild(noteDisplay);
  }

  const bubblePencil = document.getElementById("edit-pencil-bubble");
  if (bubblePencil) bubblePencil.style.display = "inline";
}

// Handle friends section click
document.getElementById('FriendsSection').addEventListener("click", function(event) {
  document.getElementById("friendsListSection")?.classList.add("active"); 
  document.getElementById("search-section")?.classList.remove("active"); 
  fetchFriendsList();
});

  
  
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById('Edit-your-profile')?.addEventListener("click", function(event) {
      document.getElementById("Edit-profile")?.classList.add("active"); 
      document.getElementById("dropdownMenu")?.classList.remove("active"); 
      document.getElementById("search-section")?.classList.remove("active"); 
      
      const newAvatar = document.querySelector("#Edit-profile .avatar");
document.querySelector(".avatar").src = document.querySelector(".manage-profile").src;
        document.querySelector(".real-username").textContent = document.getElementById("profile-name")?.textContent || "Username";
    });
  });
  
  
document.addEventListener('DOMContentLoaded', function () {
    const loginHistoryButton = document.querySelector('.login-history-btn');
    const loginHistoryModal = document.getElementById('loginHistoryModal');
    const closeModalButton = document.querySelector('.history-close-btn');
    const loginHistoryList = document.getElementById('login-history-list');

    // Open modal when the button is clicked
    loginHistoryButton.addEventListener('click', function() {
        loginHistoryModal.classList.add('open');
        fetchLoginHistory(); // Fetch login history when the modal is opened
    });

    // Close modal when the close button is clicked
    closeModalButton.addEventListener('click', function() {
        loginHistoryModal.classList.remove('open');
    });

    function fetchLoginHistory() {
        // Get user_id from sessionStorage
        const userId = sessionStorage.getItem('user_id');

        // Check if user_id exists in sessionStorage
        if (!userId) {
            console.error('User ID is not available in session storage');
            loginHistoryList.innerHTML = '<li>User not logged in.</li>';
            return;
        }

        // Send user_id as a query parameter with GET request
        fetch(`login_history.php?user_id=${userId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayLoginHistory(data.history);
            } else {
                loginHistoryList.innerHTML = `<li>${data.message || 'No login history found.'}</li>`;
            }
        })
        .catch(error => {
            console.error('Error fetching login history:', error);
            loginHistoryList.innerHTML = '<li>Error fetching login history.</li>';
        });
    }

    function displayLoginHistory(history) {
        loginHistoryList.innerHTML = ''; // Clear the list first
        if (history.length === 0) {
            loginHistoryList.innerHTML = '<li>No login history found.</li>';
        } else {
            history.forEach(entry => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>User Agent:</strong> ${entry.user_agent} <br><strong>Login Time:</strong> ${entry.login_time}`;
                loginHistoryList.appendChild(listItem);
            });
        }
    }
});

document.addEventListener("DOMContentLoaded", () => {
  const emailInput = document.getElementById("userEmail");
  const aboutInput = document.getElementById("userAbout");
  const saveBtn = document.querySelector(".save-profile-btn");

  // 1. Load profile data on page load
  function loadProfile() {
    const user_id = sessionStorage.getItem("user_id"); // <-- Fetch user_id inside function
     
    if (!user_id) {    	
      return;
    }

    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action: "get_profile", user_id: user_id }) // <-- Include user_id
    })
    .then(res => res.json())
    .then(data => {
      if (emailInput && aboutInput) {
        emailInput.value = data.email;
        aboutInput.value = data.about;
      }
    })
    .catch(error => console.error("Error loading profile:", error));
  }

  // 2. Save profile when Save button is clicked
  function saveProfile() {
    const user_id = sessionStorage.getItem("user_id"); // <-- Fetch user_id inside function

    if (!user_id) {
      alert("User not logged in.");
      return;
    }

    const email = emailInput.value.trim();
    const about = aboutInput.value.trim();

    fetch("backend.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "save_profile",
        user_id: user_id,
        email,
        about
      })
    })
    .then(res => res.text())
    .then(response => {
      console.log("Raw response:", response);
      if (response.includes("success")) {
        alert("Profile updated successfully!");
      } else {
        alert("Failed to update profile.");
      }
    })
    .catch(error => {
      console.error("Error saving profile:", error);
      alert("Something went wrong.");
    });
  }

  if (saveBtn) {
    saveBtn.addEventListener("click", saveProfile);
  } else {
    console.warn("Save button not found: .save-profile-btn");
  }
  document.getElementById('Edit-your-profile').addEventListener('click', function (event) {
       loadProfile();
       });
});

document.addEventListener('keydown', function (e) {
        if (
            e.key === 'F12' ||
            (e.ctrlKey && e.shiftKey && ['I', 'J', 'C', 'K', 'U'].includes(e.key))
        ) {
            e.preventDefault();
            location.reload();
        }
    });
    
  function toggleNetworkPopup(show) {
    const popup = document.getElementById('network-popup');
    popup.style.display = show ? 'flex' : 'none';
  }

  function checkConnection() {
    const isPoorConnection = !navigator.onLine ||
      (navigator.connection && navigator.connection.downlink < 0.5);
    toggleNetworkPopup(isPoorConnection);
  }

  window.onload = checkConnection;
  window.addEventListener('online', checkConnection);
  window.addEventListener('offline', checkConnection);
  if (navigator.connection) {
    navigator.connection.addEventListener('change', checkConnection);
  }
  
  const originalSetItem = sessionStorage.setItem;

  // Override it with a proxy
  sessionStorage.setItem = function(key, value) {
    const existingKeys = ['username', 'user_id', 'password'];

    if (existingKeys.includes(key) && sessionStorage.getItem(key) !== null) {
      console.warn(`Detected manual overwrite of "${key}". Clearing sessionStorage.`);
      sessionStorage.clear();
      window.location.reload();
      return; // Don't allow setting
    }

    // If it's a new key or not in critical keys, allow setting
    originalSetItem.apply(this, arguments);
  };
  
const profileIconInput = document.getElementById('profileIconInput');
const selectedImage = document.getElementById('selectedImage');
const profileIconmodal = document.getElementById('profileEditorModal');
const profileIconPreview = document.getElementById('profileIconPreview');

function previewProfileIcon(input) {
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function(e) {
      selectedImage.src = e.target.result;
      profileIconmodal.style.display = 'flex';
    };
    reader.readAsDataURL(input.files[0]);
  }
}

// Send request to update profile icon
document.getElementById('saveProfileImage').onclick = function () {
  const file = profileIconInput.files[0];
  const user_id = sessionStorage.getItem('user_id');

  if (!file || !user_id) {
    alert('Missing file or user ID');
    return;
  }

  const formData = new FormData();
  formData.append('action', 'update_profile_icon');
  formData.append('user_id', user_id);
  formData.append('profile_icon', file);

  imageWrapper.classList.add('loading-border');

  fetch('backend.php', {
    method: 'POST',
    body: formData
  })
  .then(response => response.text())
  .then(text => {
    console.log('Raw response:', text);
    try {
      const data = JSON.parse(text);
      console.log('Parsed JSON:', data);
      if (data.success) {
        profileIconPreview.src = data.path;
        profileIconmodal.style.display = 'none';
      } else {
        alert(data.message || 'Upload failed');
      }
    } catch (error) {
      console.error('Error parsing JSON:', error);
      alert('An error occurred while processing the response.');
    }
  })
  .catch(error => {
    console.error('Network error:', error);
    alert('There was an error updating the profile icon.');
  })
  .finally(() => {
    imageWrapper.classList.remove('loading-border');
  });
};

document.querySelector('.back-arrow').addEventListener('click', function (event) {
	document.getElementById("Edit-profile")?.classList.remove("active"); 
      document.getElementById("search-section")?.classList.add("active"); 
      });
	
	function previewProfileIcon(event) {
  const reader = new FileReader();
  reader.onload = function () {
    document.getElementById('signUp-profile-preview').src = reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}

document.getElementById('profile-settings').addEventListener('click', function (event) {
	document.getElementById("Edit-profile")?.classList.remove("active"); 
      document.getElementById("profile-settings-section")?.classList.add("active"); 
      document.getElementById("profileIconInSettings").src = document.querySelector(".manage-profile").src;
      document.querySelector(".profile-settings-username") = document.querySelector(".manage-profile");
      });
      
document.getElementById('Dark-Mode').addEventListener('click', function (event) {      
	document.getElementById("Dark-Mode-Section")?.classList.add("active"); 
    document.getElementById("profile-settings-section")?.classList.remove("active"); 
    });
    document.querySelector('.back-profile-settings').addEventListener('click', function (event) {      
	document.getElementById("Dark-Mode-Section")?.classList.remove("active"); 
    document.querySelector(".profile-settings-username").textContent = document.getElementById("profile-name")?.textContent || "Username";
    });
</script>
</body>
</html>